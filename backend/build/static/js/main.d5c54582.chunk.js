(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(e,t,n){e.exports=n(29)},27:function(e){e.exports={meta:{name:"Startup example",uuid:null},data:[{text:"# Re:writing"},{text:""},{text:"Writing is rewriting."},{text:""},{text:"This is a simple tool, which allows the writer, to systematically breakdown each paragraph into component sentences, iterate over them until the paragraph is complete.",versions:[">This is a crude tool",">A new way to rewrite","This is a simple tool,",">",">and it allows the student,",">that empowers the the author,","which allows the writer,",">",">to systematically breakdown each paragraph into component sentences, and iterate over new versions until the paragraph is complete.","to systematically breakdown each paragraph into component sentences, iterate over them until the paragraph is complete.",""],locked:"locked",className:"className"},{text:""},{text:"The interface is split into two parts which can be resized, and there is a file and settings menu on the left, which remains hidden, to keep the work area clean."},{text:""},{text:"To open the menu move your mouse to the left edge of the screen. The menu will open to reveal various self explanatory preferences.",selected:"selected"}]}},28:function(e,t,n){},29:function(e,t,n){"use strict";n.r(t);var a=n(1);var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:">",n=Object(a.a)(e).map(function(e){var t=e.classList.contains("inactive");return{text:"".concat(e.innerText).trim(),hidden:t}}).map(function(e){var n=e.hidden?t:"",a=e.text;return"".concat(n).concat(a)});return Object(a.a)(n)},i=n(2),o=0,s=0;var c=function(){return((o+=1)%6+10).toString(16)+(new Date).valueOf().toString(16)+(1e3+(s+=1)%999)+""},l=/(\.|:|!|\?|"|\))$/g;var u=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e=e&&e.trim()){var n=l.test(e),a=t&&!n?".":"";return"".concat(e).concat(a)}};var d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e){var t=e.trim();return/\r/.test(e)&&(t=t.replace(/\r/gm,"")),t=(t=(t=(t=t.split(/\n{2,}/gm)).map(function(e){return e.replace(/\n+/g," ").replace(/\s{2,}/g," ").trim()||""})).join("\n\n")).split(/\n/g),Object(a.a)(t)}},f=/^([\/>?=!]\s*?)/;var h=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"";var n=e&&e.constructor===Array?e:d(e);return Object(a.a)(n).map(function(e){return f.test(e)?null:u(e,t)}).filter(function(e){return e&&e.length}).join(" ").trim()},m={re:{lineEnd:/(^\w|[.?!;]\s+\w)/g,newLine:/^-{3,}/,commentChars:/^(\s+)?[>?!\/]+(\s+)?/,passiveKeys:/^(arrow|shift|control|alt|tab|page|home|end|escape)/i},timer:{default:100,delay:0},options:{flag:"inactive",re:/^(\s+)?[>?!\/]+(\s+)?/,tag:"p",br:"<br/>",markdown:!1,scrollToSelected:!0}},v=function(e,t){if(!e)return;var n=Object(i.a)({},m.options,{options:t}),a=n.tag,r=n.br,o=n.re,s=n.flag,l=!0,u=e.map(function(e){var t={},n={},i={},u=/^(text|versions|locked|selected|html|classnames)/i,d=e.text,f=void 0===d?"":d,m=e.versions,v=void 0===m?"":m,g=e.selected,p=void 0===g?"":g,y=v?c():"",w=v&&h(v),b=f||w||"",k=v?JSON.stringify(v):"",O=!(!v||w),E=o.test(b)||e.inactive;t.locked=!!v||null,t[s]=!!E||null,t.selected=!(!l||!p)||null,t.empty=!!O||null,Object.keys(e).forEach(function(a){if(!(u.test(a)||a in t))return/^m-/i.test(a)?/^(true)$/i.test(e[a])?n[a]=!0:i[a]=JSON.stringify(e[a]):void(t[a]=!0)}),e&&e.classnames&&e.classnames.forEach(function(e){t[e]=!0}),t=Object.keys(t).map(function(e){return t[e]?e:""}).join(" ").trim()||null,l=!p&&l,i=Object.keys(i).map(function(e){return"data-".concat(e,"='").concat(i[e],"'")}),i=(i=" ".concat(i.join(" "))).trim()?" ".concat(i):"";var j={};j.id=y?' id="'.concat(y,'"'):"",j.className=t?' class="'.concat(t,'"'):"",j.dataset=v?" data-versions='".concat(k,"'"):"",j.innerHTML=b.replace(o,"")||r,n=Object.keys(n).map(function(e){return"".concat(e,'=""')}),n=(n="".concat(n.join(" "))).trim()?" ".concat(n):"";var N=document.createElement(a);return N.id=y,N.dataset.versions=JSON.stringify(w),"<".concat(a).concat(j.id).concat(j.className).concat(n).concat(i).concat(j.dataset,">").concat(j.innerHTML,"</").concat(a,">")});/<br\s?\/?>/i.test(u.slice(-1))||u.push("<".concat(a,">").concat(r,"</").concat(a,">"));return u.join("\n")};var g=n(14),p=n.n(g),y={};var w=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e&&t){y[e]||(y[e]={ns:e,fn:t,ms:n,t:null,n:0,verbose:!0===a});var r=(!1).verbose,i=void 0!==r&&r;y[e].n+=1,i&&console.log("CALLING REGISTER [%s]",e,y[e].n),clearTimeout(y[e].t),y[e].t=setTimeout(function(){return i&&console.log("EXECUTING REGISTER [%s]",e,y[e].n),delete y[e],t()},n)}},b=n(11),k={json:["json","json"],text:["text","txt"],markdown:["text","md"]};var O=function(e){var t=e.name,n=e.id,a=e.data,r=e.type,i=void 0===r?"json":r,o=e.appendId,s=void 0===o||o,c=Object(b.a)(k[i],2),l=c[0],u=c[1],d=s?"-".concat(n):"",f="".concat(t).concat(d,".").concat(u),h="json"===i?JSON.stringify(a):a,m=document.createElement("a"),v=encodeURIComponent(h);m.setAttribute("href","data:text/".concat(l,";charset=utf-8,").concat(v)),m.setAttribute("download","".concat(f)),m.style.display="none",document.body.appendChild(m),m.click(),document.body.removeChild(m)};var E=function(e,t,n){var r=document.querySelectorAll(".".concat(t));return Object(a.a)(r).forEach(function(e){return e.classList.remove(t)}),e.setAttribute("tabindex","-1"),e.classList.add(t),e.focus(),n&&n()},j=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{e=e.replace(/'/g,"\u2019"),t=JSON.parse(e)}catch(a){console.error("JSON parse Error!\nUsing alternative:[%s]",n),console.log(a),t=n}return t};var N=function(e){var t=/<[^<]+>/gi;return Object(a.a)(e).map(function(e){var n=e.innerText,r=void 0===n?"":n,i=e.innerHTML,o=e.dataset,s=e.nodeName,c=e.classList;if(!/(div|p)/i.test(s))return null;var l=r&&r.trim()||i&&i.replace(t,""),u=o.versions&&j(o.versions,l),d={};return d.text=l||"",u&&(d.versions=u),Object(a.a)(c).forEach(function(e){return d[e]=e}),d}).filter(function(e){return e})},S=n(9),T=n.n(S);var x=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=T.a.sentences(e);return t?n:n.join("\n")},C={confirmDelete:"\nYou are unlocking this paragraph. \n\nThis will delete the working versions and destill \nthe paragraph to the currently elected candidate.\n\n[CANCEL] to keep working versions\n[OK] to discard versions\n"},L=function(e){var t=e.currentTarget.files[0],n=t.name,a=new FileReader;return new Promise(function(e,r){a.onerror=function(){a.abort(),r(new DOMException("Problem parsing input file."))},a.onload=function(t){var a={name:n,result:t.target.result};e(a)},a.readAsText(t)})};var A=function(e){if(e){var t=e.innerText,n=e.dataset,a=n.versions;return e.classList.remove("empty"),t.replace(/^\(empty\)$/,"")||(e.classList.add("empty"),t="(empty)"),t=t?T.a.sentences(t):[""],n.versions?j(a):t}};var D,I,P,R,M,z=function(e){var t=e.toLowerCase(),n=e.toUpperCase();return e=e!==n?n:t.replace(/(^\w|[.?!;]\s+\w)/g,function(e,t){return e.toUpperCase()})},J=/^en-(uk|gb)/i,W=null;function q(){if(R=window.speechSynthesis,M=R.getVoices(),I=I||navigator.languages,!M)return P&&clearTimeout(P),P=setTimeout(q,150);var e=null;console.log(M.length,I),M=M.filter(function(e){return e.lang.indexOf(I[1])+1}),e=(D=M.filter(function(e){return J.test(e.lang)})).length&&D.findIndex(function(e){return/female/gi.test(e.name)}),e=Math.max(e,0),console.log("TTS initialized",D.length,e),W=D.length?D[e]:M[0],console.log("selectedVoice",W)}function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=new SpeechSynthesisUtterance,a=W||null;return a?(Object.assign(n,{volume:1,pitch:1,rate:1,voice:a,text:e}),R.speak(n)):setTimeout(function(){console.warn("Say this is not ready. Reloading."),q(),H(e,t)},450)}var $={initialize:q,say:H,read:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(R||q(),R.speaking)return R.cancel();if(e){var n=e.constructor===Array?e:e.split("\n");n=(n=(n=n.filter(function(e){return String(e||"")})).map(function(e){return e.replace(/[\u201c\u201d_]+/gm,"")})).map(function(e){return e.split(/[.]/g)}),n=[].concat.apply([],n),console.log("Total sentences [%s]",n.length),n.forEach(function(e,n){return H("".concat(e).concat(t),n)})}},voice:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return D&&D.length||q(),W=D[e]},speaking:function(){return window.speechSynthesis.speaking},cancel:function(){return window.speechSynthesis.cancel()}};var U=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=e;return n=(n=(n=(n=n.split(/\n{2,}/gm)).map(function(e){return t?function(e,t){var n="";return e.split(/\n/g).forEach(function(e){var a=String(e||"").trim(),r=t.some(function(e){return e.test(a)});a&&(n+=r?"\n".concat(a,"\n"):"".concat(a," "))}),n.replace(/\n{2,}/,"\n").trim()}(e,t):e.replace(/\n+/g," ").replace(/\s{2,}/g," ").trim()||""})).join("\n\n")).split(/\n/g),Object(a.a)(n)};var V=function(e){return(e=String(e||""))&&(e=(e=(e=(e=e.replace(/(\w)[-]+(\w)/g,"$1$1")).replace(/[\W"]+/g," ")).replace(/(\s{1,})/g," ")).trim()).length?e.split(" ").length:0},B=window.localStorage;var G={context:function(e){B=e},backup:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=null,n=new RegExp("^".concat(e));return Object.keys(B).filter(function(e){return n.test(e)}).forEach(function(e,a){var r=e.replace(n,"");(t=t||{})["BAK-".concat(r)]=B[e]}),t},restore:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;if(t){var n=e?"".concat(e,"-"):"",a={articles:[],settings:{}};Object.keys(t).forEach(function(e,n){var r=e.replace(/(^[^-]+-+)/,""),i=t[e],o=/^[[{'"]/.test(i)?JSON.parse(t[e]):i,s=(new Date).valueOf();if(/[a-z0-9]{16}$/.test(e))return"data"in o||"meta"in o||(o={meta:{uuid:r,name:"Untitled ".concat(n),username:null,created:s,modified:s,wordtarget:0},data:o}),void(a[r]=o);/(settings|articles)$/i.test(r)&&(a[r]=o)});var r=[];a.articles.forEach(function(e,t){var n=e.uuid||e.guid,o=(new Date).valueOf();a[n].meta=Object(i.a)({},e),a[n].meta.uuid=n,a[n].meta.modified=o,delete a[n].meta.opened,r.push({uuid:n,name:e.name,modified:o,created:o})}),a.articles=r;var o=a.settings,s=o.previous,c=o.current;return a.settings.current=s||c||r[0].uuid,delete a.settings.previous,delete a.settings.settings,Object.keys(a.settings).forEach(function(e){/^[0-9]+$/.test(e)&&delete a.settings[e]}),Object.keys(a).forEach(function(e){var t=a[e],r=JSON.stringify(t);B["".concat(n).concat(e)]=r}),B}},purge:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object.keys(B).forEach(function(t){return t.indexOf(e)+1?delete B[t]:null})},keys:function(){return Object.keys(B)}};var K=function(e){if(e&&"number"===typeof e){var t=Math.round(.75292857248934*e);return t=parseInt(t,10)}};function F(e){return!(!e||"Invalid Date"===e||isNaN(e))}var Y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t=t||new Date,!F(e="string"===typeof e?new Date(Number(e)):new Date(e))||!F(t)||e>t)return null;if(t.valueOf()-e.valueOf()<3e4)return"Now";var n,a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=e.toString().split(/[\s:]/g);e=e.valueOf();var a=(t=t||(new Date).valueOf())-e,r=Object(b.a)(n,9),o=r[0],s=r[1],c=r[2],l=r[3],u=r[4],d=r[5],f=r[6],h=r[7],m=r[8],v="".concat(u,":").concat(d),g=[{name:"milisecond",value:1},{name:"second",value:1e3},{name:"minute",value:60},{name:"hour",value:60},{name:"day",value:24},{name:"week",value:7},{name:"month",value:52/12},{name:"year",value:12}];g.reduce(function(e,t){return t.diff=e/t.value,e/t.value},a);var p=g.filter(function(e){return e.diff>=1}),y=g[p.length-1];return Object(i.a)({},y,{time:v,weekday:o,month:s,day:Number(c),year:Number(l),hour:Number(u),minute:Number(d),second:Number(f),offset:h,tz:m})}(e,t);switch(a.diff=parseInt(a.diff),a.name){case"milisecond":n="Now";break;case"second":if(a.diff<30){n="Now";break}n="".concat(parseInt(a.diff)," seconds ago");break;case"minute":if(a.diff<2){n="A minute ago";break}n="".concat(parseInt(a.diff)," minutes ago");break;case"hour":if(a.diff<2){n="An hour ago";break}if(a.diff<12){n="".concat(a.diff," hours ago");break}n="At ".concat(a.time);break;case"day":if(a.diff<2){n="Yesterday at ".concat(a.time);break}n="".concat(a.weekday," at ").concat(a.time);break;case"week":if(a.diff<2){n="Last ".concat(a.weekday," at ").concat(a.time);break}n="".concat(a.weekday," ").concat(a.day," ").concat(a.month," at ").concat(a.time);break;case"month":if(Number(a.year)===t.getFullYear()){n="".concat(a.weekday," ").concat(a.day," ").concat(a.month," at ").concat(a.time);break}default:n="".concat(a.day," ").concat(a.month," ").concat(a.year," ").concat(a.time)}return n},X=document.location.origin;X=/localhost/i.test(X)?X.replace(/[0-9]+$/,"5000"):X,console.log("API origin",X);var _={settings:"".concat(X,"/api/v1.0/settings/"),article:"".concat(X,"/api/v1.0/article/"),user:"".concat(X,"/api/v1.0/user/")};var Q=function(){var e=["rewrite",arguments.length>0&&void 0!==arguments[0]?arguments[0]:null].filter(function(e){return e}).join("-"),t=window.navigator.onLine,n=this.localStorage||window.localStorage;return{data:function(){return n},delete:function(){delete n[e]},pull:function(e,n){t||n(null),console.log("pull from api %s (%s)",e,_.user),fetch("".concat(_.user).concat(e),{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){var t=Object(i.a)({},e.settings),a=t.previous||t.current||null,r=Object.keys(e).filter(function(e){return/^[a-z0-9]{16}/.test(e)}).map(function(t){return e[t].meta});delete e.settings;var o=Object(i.a)({},e,{settings:t,articles:r,previous:a});n({status:200,data:o})})},getUser:function(e){if(t)return fetch("".concat(_.user).concat(e),{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()});console.log("not online")},deleteArticle:function(e){t?e?fetch("".concat(_.article).concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(console.log):console.error("property missing [%s]",e):console.log("not online")},updateArticlesData:function(e){var t=/[a-z][a-z0-9]{15}$/i,a=[];return Object.keys(n).filter(function(e){return t.test(e)}).forEach(function(e){var t=JSON.parse(n[e]);a.push(t.meta)}),n["rewrite-articles"]=JSON.stringify(a),e&&e.construcor===Function?e(a):a},updateArticle:function(e,n,a){if(t)if(e&&n&&a){var r=a.construcor===String?a:JSON.stringify(a);fetch("".concat(_.article).concat(e,"/").concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:r}).then(function(e){return e.json()}).then(function(t){return console.log(t,e,n)})}else console.error("property missing user[%s] uuid[%s]",e,n,a);else console.log("not online")},updateSettings:function(e){var t=e.guid;t?fetch("".concat(_.settings).concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){return console.log(e)}):console.warn("Cant push settings. No username",e)},update:function(e){var t=e.uuid;fetch("".concat(_.article).concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){return console.log(e)})},push:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t){if(e)return console.log("push to api %s",e,_.settings,_.article),w("push",function(){var t={};Object.keys(n).filter(function(e){return/^rewrite/i.test(e)}).map(function(e){var a=e.replace(/^([^-]+-+)/,"");return t[a]=n[e],e});var a={};t.settings=JSON.parse(t.settings),Object.keys(t.settings).filter(function(e){return/^([a-z]+)$/i.test(e)}).forEach(function(e){/^settings/i.test(e)||(a[e]=t.settings[e])}),fetch("".concat(_.settings).concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(function(e){return e.json()}).then(function(e){return console.log(e)}),console.log(t.articles),JSON.parse(t.articles).forEach(function(n){var a=n.guid||n.uuid,r={meta:{uuid:a,username:e,created:n.created,modified:n.modified||n.opened,name:n.name,wordtarget:n.wordtarget},data:JSON.parse(t[a])};fetch("".concat(_.article).concat(e,"/").concat(a),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(function(e){return e.json()}).then(function(e){return console.log(e)})})},a||1e4);console.log("no guid")}else console.log("not online")},backup:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a="".concat(e,"-backup"),r={averages:[],datas:[]},i=t||(new Date).valueOf();return w(a,function(){var t=n[e]||null,o={tag:i,data:t},s=0,c=n[a]||null,l=[99],u=[o];if((c=c?JSON.parse(c):r).datas.length){s=c.datas.length-1;var d=JSON.stringify(o),f=JSON.stringify(c.datas.slice(-1)),h=Math.min(d.length,f.length),m=Math.max(d.length,f.length),v=parseInt(h/m*100,10),g=v/(c.averages.reduce(function(e,t){return e+Number(t||0)})/c.averages.length)*100<78;g?(console.warn("Insert backup. [%s] (%s)",g,78),c.datas.push(o)):(c.averages.push(v),c.datas[s]=o),l=c.averages.slice(-25),u=c.datas}c={averages:l,datas:u},n[a]=JSON.stringify(c)},1e3)},read:function(t){var a=n[e]||null,r=a&&/^[[{"]/.test(a)?JSON.parse(a):a;return t&&t.construcor===Function?t(r):r},write:function(t){var a=function(){return n[e]=JSON.stringify(t)};return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?w(e,a,250,!0):a()}}},Z={alert:function(e){return window.alert(e)},confirm:function(e){return window.confirm(e)},prompt:function(e,t){return window.prompt(e,t)},backupRestore:G,childrenToVersionArray:r,collectionToHtml:v,deepEqual:p.a,defer:w,elapsed:Y,download:O,focusOn:E,htmlToCollection:N,inflate:x,jsonParseSafe:j,message:function(e){return C[e]||"WARNING:\n\nCan't find [".concat(e,"] message.")},points:K,readTextFile:L,selectedValueArray:A,storage:Q,time:function(){return(new Date).toString().replace(/.* (\d+:\d+:\d+) .*/g,"$1")},toggleStringCase:z,tts:$,unwrap:U,uuid:c,wordcount:V};var ee=n(0),te=n.n(ee),ne=n(12),ae=n.n(ne),re=n(4),ie=n(8),oe=n(6),se=n(7),ce=n(3),le=n(5);var ue=function(){var e=this.texteditor;e.onkeydown=function(e){var t=this,n=this.re.passiveKeys.test(e.key);if(this.selected&&this.selected.dataset.versions&&!n)return console.log("versions and NOT passive"),!1;var a=this.updateKeysPressed(e,!0),r=Object.keys(this.triggers).find(function(e){var n=t.triggers[e],r=n.re,i=n.fn;return r&&r.test(a)?i:null});return console.log("ONKEYDOWN",e.key,e.code,a),this.trigger(r,e)}.bind(this),e.onkeyup=function(e){var t=this;this.deselect();var n=this.re.passiveKeys.test(e.key),a=e.type,r=e.key,i=window.getSelection().focusNode,o=i.parentNode.nodeName,s=i.parentNode;if(/^enter/i.test(r))return i.id="",void this.deselect();if("P"===o){var c=s.innerText;if(!c||!c.trim())return console.log("no inner text"),void this.deselect();this.setSelected(s),console.log("ONKEYUP [%s] <%s>",a,o,r);var l=this.timer.after;this.timer.delay=n?75:this.timer.default,this.defer("change",function(){return t.triggers.change.fn.call(t,e)}),this.wordcounter(),this.defer("after",function(){return t.triggers.after.fn.call(t)},l)}else console.log("not P tag",a)}.bind(this),e.onclick=function(e){this.deselect(),this.setSelected(e.target),this.triggers.click&&this.triggers.click.fn.call(this,e)}.bind(this)};var de=m.options;var fe,he=function(e,t){if(t&&(de=Object(i.a)({},de,t)),e){var n=de,r=n.flag,o=n.re,s=n.tag,c=n.br;return Object(a.a)(e).map(function(e){var t="".concat(e).replace(o,"").trim()||c;t="string"!==typeof e?c:t;var n=[];return o.test(e||"")&&n.push(r),n=(n=n.length?n.join(" "):null)&&' class="'.concat(n,'"')||"","<".concat(s).concat(n,">").concat(t,"</").concat(s,">")}).join("\n")}},me=null,ve=[],ge=function(e,t){var n=e.key.trim()||e.code;return ve.push(n),me&&clearTimeout(me),me=setTimeout(function(){return ve=[]},250),t?ve.join(""):Object(a.a)(ve)},pe=n(10),ye=n.n(pe),we=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:/^>/;arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.map(function(e){var n="string"===typeof e?{html:null,text:"".concat(e).trim(),inactive:t.test(e),classnames:[]}:e,a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return{score:null,name:""};var t,n=ye.a.ease("".concat(e)).score,a=parseInt(n/10,10);return t=Math.min(a,10),t=10-(t=Math.max(3,t))-1,{score:t=Math.max(0,t),name:be[t||0]}}(n.text),r=(a.score,a.name);return r&&(n.classnames=n.classnames||[],n.classnames.push("read-".concat(r))),n})},be=["very-easy","easy","fairly-easy","plain-english","fairly-difficult","difficult","very-difficult","unknown"];var ke=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(re.a)(this,e),this.options=Object(i.a)({flag:"inactive",re:/^(\s+)?[>?!\/]+(\s+)?/,unwrap:!0,tag:"p",br:"<br/>",markdown:!1,filterInactive:!0},n),t||(t=""),t.data&&(console.warn("Coersing data from Object"),t=t.data);var r=this.options,o=r.re,s=r.unwrap,c=r.markdown,l=t.constructor,u=(l===Object?"object":l===String&&"string")||l===Array&&"array"||l===HTMLCollection&&"html"||"unknown";switch("object"===u&&t.data&&(console.warn("Coerse data array"),u="array",t=t.data),u){case"string":t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";/\r/.test(e)&&(e=e.replace(/\r/gm,""));return e}(t),t=s?U(t):t.split(/\n/g),t=we(t,o,c);break;case"array":t=we(t,o,c);break;case"html":t=N(t);break;default:console.error("WARNING! switch fallthrough for",u,l,t)}fe=Object(a.a)(t)}return Object(le.a)(e,[{key:"toHTML",value:function(){var e=this.options;return v.call(this,fe,e)}},{key:"toText",value:function(){var e=Oe(fe,this.options).join("\n");return e=e.replace(/(\s+)?$/g,"")}},{key:"toArray",value:function(){return Oe(fe,this.options)}},{key:"toCollection",value:function(){return fe}}]),e}();function Oe(e,t){var n=t.filterInactive,r=void 0!==n&&n;return Object(a.a)(e).map(function(e){return r?(t=e).inactive||t.empty?null:/\(empty\)/.test(t.text)?null:"".concat(t.text):"".concat(e.text);var t}).filter(function(e){return null!==e})}var Ee=function(){Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;var t=this.parentNode,n=window.getComputedStyle(t,null),a=parseInt(n.getPropertyValue("border-top-width")),r=parseInt(n.getPropertyValue("border-left-width")),i=this.offsetTop-t.offsetTop<t.scrollTop,o=this.offsetTop-t.offsetTop+this.clientHeight-a>t.scrollTop+t.clientHeight,s=this.offsetLeft-t.offsetLeft<t.scrollLeft,c=this.offsetLeft-t.offsetLeft+this.clientWidth-r>t.scrollLeft+t.clientWidth,l=i&&!o;(i||o)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-a+this.clientHeight/2),(s||c)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-r+this.clientWidth/2),(i||o||s||c)&&!e&&this.scrollIntoView(l)})};document.execCommand("defaultParagraphSeparator",!1,"p");var je=function(){function e(t,n){var a=this;Object(re.a)(this,e),this.wordcounter=function(e){a.defer.call(a,"wordcounter",function(){e=e||a.triggers.wordcounter.fn;var t=document.createElement("span"),n=a.texteditor.innerText;if(t.classList.add("value"),a.words=V(n),t.innerHTML=a.words,a.wordtarget){var r=a.wordtarget-a.words<0?"-warn":"";t.classList.add("value".concat(r)),t.innerHTML="".concat(a.words,"/").concat(a.wordtarget)}if(a.showReadability){var i=ye.a.ease(n).score;i=parseInt(i,10),t.innerHTML="".concat(t.innerHTML," (").concat(i,"%)")}return e(t.outerHTML)},150)},this.init=function(e){if(e){var t=new ke(e,{markdown:a.markdown});a.texteditor.innerHTML=t.toHTML(),a.show(),a.wordcounter();var n,r=a.texteditor.querySelector(".selected");r&&(setTimeout(function(){return a.focus()},850),a.setSelected(r),n=r.dataset.versions?JSON.parse(r.dataset.versions):x(r.innerText),a.parent.init(n))}};var r=document.getElementById(t),i=document.createElement("article");i.setAttribute("contenteditable",""),i.setAttribute("spellcheck","true"),r.innerHTML="",r.appendChild(i),this.id=t,this.parent=null,this.keytime=null,this.selected=null,this.markdown=null,this.scrollToSelected=!0,this.words=0,this.wordtarget=0,this.showReadability=!0,this.container=r,this.texteditor=i,this.data={},this.triggers={click:{fn:function(e){return console.warn("Default event. CLICK [%s]",e)}},change:{fn:function(e){return console.warn("Default event. CHANGE [%s]",e)}},after:{fn:function(e){return console.warn("Default event. AFTER [%s]",e)}},wordcounter:{fn:function(){}}},Object.assign(this,m,n);var o=this.hidden,s=void 0!==o&&o;ue.bind(this)(),this.defer=w.bind(this),this.uuid=c.bind(this),this.arrayToHtml=he.bind(this),this.updateKeysPressed=ge.bind(this),Element&&!Element.scrollIntoViewIfNeeded&&Ee(),this.init(),this.show(!s)}return Object(le.a)(e,[{key:"bindTo",value:function(e){this.parent=e}},{key:"show",value:function(e){e=void 0===e||Boolean(e),this.hidden=!0!==e,this.container.classList[this.hidden?"add":"remove"]("hidden")}},{key:"trigger",value:function(e,t){if(e&&this.triggers[e]){var n=this.triggers[e],a=n.fn,r=n.data,i=a.call(this,t);return r&&r.constructor===Function&&(console.log(i,r),r.call(this,i)),i}}},{key:"on",value:function(e,t,n,a){this.triggers[e]={re:t,fn:n,data:a}}},{key:"deselect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"selected",t=this.texteditor.querySelectorAll(".".concat(e));Object(a.a)(t).forEach(function(t){return t.classList.remove(e)}),this.selected=null}},{key:"setSelected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e.id,n=e.innerText;if(n&&n.trim()){e.id=t||this.uuid(),e.classList.add("selected");var a=e.dataset&&e.dataset.versions?"add":"remove";e.classList[a]("locked"),this.selected=e}else console.warn("Element has no innerText value")}},{key:"focus",value:function(){var e=this.selected;this.scrollToSelected&&e&&e.scrollIntoViewIfNeeded()}},{key:"toggleMarkdown",value:function(){this.markdown=!1}},{key:"setWordTarget",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.wordtarget=e}},{key:"reset",value:function(e){if(this.parent.texteditor.innerText="",this.texteditor.innerText="",this.parent.selected=null,this.selected=null,this.words=0,this.data={},e.meta){console.warn("Reduce article to data",e);var t=e.meta.wordtarget,n=void 0===t?null:t;this.wordtarget=n,e=e.data}this.init(e)}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;console.log("UPDATE [%s]\n",e,this.markdown);var t=this.selected,n=this.re,r=n.newLine,i=n.commentChars;if(t&&e){t.dataset.versions=JSON.stringify(e);var o=e.map(function(e){var t=r.test(e)?"\n\n":e;return t=i.test(t)?"":t,"".concat(t).trim()}).filter(function(e){return e&&e.trim()}).join(" ").trim();if(Object(a.a)(t.classList).forEach(function(e){return/^md/.test(e)&&t.classList.remove(e)}),this.markdown&&o){var s=we([o],i,!0)[0];t.dataset.text=o,o=s.html||"",s.classnames&&s.classnames.length&&s.classnames.forEach(function(e){return t.classList.add(e)})}return t.classList[o?"remove":"add"]("empty"),t.classList.add("locked"),t.classList.add("selected"),t.innerHTML=o||"(empty)",t}}}]),e}(),Ne=function(e){function t(e,n){var a;return Object(re.a)(this,t),(a=Object(ie.a)(this,Object(oe.a)(t).call(this,e,n))).on("click",null,xe),a.on("toggle",/^(altalt)$/i,xe),a.on("collapse",/^(shiftshift)$/i,Se),a.on("change",null,Te),a.on("typewriter",/(home|end|page|arrow|delete|backspace)/i,Ce),a.typewriter=function(){var e=!1;return function(t){return e="boolean"===typeof t?t:e}}.call(Object(ce.a)(Object(ce.a)(a))),a}return Object(se.a)(t,e),t}(je);function Se(){this.selected?this.selected.classList.toggle("inactive"):console.warn("no selected paragraph")}function Te(){var e=Z.selectedValueArray(this.selected);this.parent.init(e)}function xe(e){if(e&&(e.preventDefault(),e.stopPropagation(),console.log(e.code)),this.selected){var t=Z.selectedValueArray(this.selected),n=this.selected,a=n.classList,r=n.dataset,i=this.selected.dataset.versions,o=i&&i.trim();return/^key/.test(e.type)&&o&&window.confirm("Are you sure")&&(a.remove("locked"),r.versions="",t=[""],this.selected.classList.contains("empty"))?(this.selected.innerText="",this.selected.className="",this.selected.remove(),this.selected=null,this.parent.init([""]),!1):(this.parent.init(t),!1)}console.log("no selected element")}function Ce(e){if(this.typewriter())return e.preventDefault(),!1}var Le=function(e){function t(e,n){var a;return Object(re.a)(this,t),(a=Object(ie.a)(this,Object(oe.a)(t).call(this,e,n))).arrayToHtml(null,{hidden:!0}),a.on("change",null,Pe),a.on("toggle",/^(shiftshift)$/i,Re),a.on("capitalize",/^(altenter)$/i,Ie),a.on("newline",/^(shiftenter)$/i,Ae),a.on("deleteline",/^(altbackspace)$/i,De),a.on("centeron",/^(controlcontrol)$/i,Me),a.on("click",null,function(){}),a}return Object(se.a)(t,e),t}(je);function Ae(e){e.preventDefault(),e.stopPropagation();var t=this.selected,n=document.createElement("p"),a=document.createElement("br"),r=window.getSelection(),i=document.createRange();return t.parentNode.insertBefore(n,t.nextSibling),n.appendChild(a),i.setStart(a,0),i.collapse(!0),r.removeAllRanges(),r.addRange(i),!1}function De(e){e.preventDefault(),e.stopPropagation(),this.selected.remove()}function Ie(){var e=this.selected.innerText;this.selected.innerText=Z.toggleStringCase(e)}function Pe(){var e=this.texteditor.children,t=Z.childrenToVersionArray(e);this.parent.update(t)}function Re(e){this.selected.classList.toggle("inactive")}function Me(e){this.parent.texteditor.querySelector(".selected").scrollIntoViewIfNeeded(!0)}var ze=n(27),Je=function(){function e(t){Object(re.a)(this,e),this.key=null,this.articles=this.list,this.storage=t,this.uuid=c,this.current=null,this.syncId=null,this.timestamp=null,this.create=function(e,t,n){if(!n)return void console.error("Create requires article schema");e=e||c(),t=t||"Untitled";var a=(new Date).valueOf(),r=(new Date).valueOf(),i={uuid:e,name:t,created:a,modified:r},o=this.storage("articles"),s=o.read()||[],l=s.findIndex(function(t){return t.uuid===e});s&&s.length&&l+1&&(console.warn("UUID exists. Replace %s",e),s.splice(l,1));s.push(i),o.write(s),this.current={meta:i,data:n};var u=this.filename(e);return this.storage(u).write(this.current),this.current}.bind(this)}return Object(le.a)(e,[{key:"filename",value:function(e,t){if(e)return[t,e].filter(function(e){return e}).join("-")}},{key:"setSyncProfile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;console.log("Profile Sync",e),this.syncId=e,this.timestamp=(new Date).valueOf()}},{key:"read",value:function(e){if(!e)return this.current=null,null;var t=this.storage,n=this.filename,a=t("settings"),r=t(n(e)).read();if(!r)return this.current=null,null;if(!r.meta||!r.data)return console.error("This article has incorrect schema. Missing meta and data"),null;var i=a.read()||{};return i.current=r.meta.uuid,a.write(i),this.current=r}},{key:"write",value:function(e){if(!e)return null;console.log("write to filesystem",this.syncId);var t=this.current,n=this.filename,r=this.storage,o=t&&t.guid;if(!o)return console.log("no current guid"),null;var s=r(n(o));s.write(e,!0),s.backup();var c=r("articles"),l=c.read(),u=l.findIndex(function(e){return e.guid===o}),d=l.splice(u,1)[0];return d.opened=(new Date).valueOf(),l=[d].concat(Object(a.a)(l)),c.write(l,!0),this.current=Object(i.a)({},this.current,{data:e}),this.current}},{key:"import",value:function(e){}},{key:"export",value:function(){}},{key:"list",value:function(e){return this.storage("articles").read()}},{key:"open",value:function(e,t){e||console.error("Cant open, require files array"),L(e).then(function(e){var n=e.name,a=e.result;return t(n,a)})}},{key:"save",value:function(e){if(this.current){var t=this.current,n=t.guid,a=t.name,r=t.data;return O({id:n,name:e||a,data:r})}console.error("No current article to download")}},{key:"rename",value:function(e,t){if(e&&t){var n=this.list(),a=n.findIndex(function(t){return t.uuid===e}),r=this.storage("articles");return n[a].name=t,r.write(n),!0}}},{key:"delete",value:function(e){if(!e)return console.log("Cant delete [%s]",e),!1;var t=this.storage,n=(this.current||{}).meta,a=void 0===n?null:n,r=this.list().filter(function(t){return t.uuid!==e});return t("articles").write(r),t(e).delete(),a&&a.uuid===e&&(console.warn("Deleting current article %s",e),this.read(this.list()[0].uuid)),!0}},{key:"initilize",value:function(){var e=c(),t=ze.meta.name,n=this.storage("settings"),a=(n.read()||{}).current,r=void 0===a?null:a;return this.list()||(this.create(e,t,ze),n.write({current:e}),console.warn("create default example article [%s]",e)),r&&this.read(r),this.current}}]),e}();var We=function(e){function t(e){var n;return Object(re.a)(this,t),(n=Object(ie.a)(this,Object(oe.a)(t).call(this))).rename=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=n.state,a=t.guid,r=t.name,i=t.original,o=i;!e&&r&&r.trim()&&r!==i&&(o=r.trim(),n.props.store.rename(a,o)),n.setState({edit:!1,name:o,original:o})},n.toggleEditAndFocus=function(e){e.stopPropagation(),n.setState({edit:!0});var t=n.state.guid;setTimeout(function(){return document.querySelector("#".concat(t)).focus()},150)},n.state={edit:!1,name:e.name,original:e.name,guid:e.guid},n}return Object(se.a)(t,e),Object(le.a)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.name,a=t.edit,r=t.guid;return a?te.a.createElement("input",{id:r,type:"text",tabIndex:"0",value:n,onBlur:function(){return e.rename()},onChange:function(t){e.setState({name:t.target.value})},onClick:function(e){return e.stopPropagation()},onKeyDown:function(t){var n=t.key,a=!1;/^(escape)/i.test(n)&&(n="enter",a=!0),/^(enter)/i.test(n)&&(e.rename(a),t.target.blur())}}):te.a.createElement("span",{className:"file-toggle-input"},n,te.a.createElement("a",{href:"#edit",onClick:this.toggleEditAndFocus},"edit"))}}]),t}(te.a.Component);var qe,He,$e,Ue,Ve=function(e){var t=e.object,n=e.callbacks,a=t.guid,r=t.uuid,i=t.name,o=t.wordtarget,s=t.opened,c=n.store,l=n.getArticleByGuid,u=n.updateCurrent,d=n.handleDelete,f=n.handleWordTarget,h=n.downloadText,m=n.downloadJson,v=o?"".concat(o," words"):"add",g=a||r;return te.a.createElement("div",{className:"inner",onClick:function(){l(g),u(g)}},te.a.createElement("span",{className:"file-name","data-guid":g},te.a.createElement(We,{name:i,guid:g,store:c})),te.a.createElement("ul",{className:"file-meta"},te.a.createElement("li",null,te.a.createElement("a",{href:"#delete",onClick:function(e){e.preventDefault(),e.stopPropagation(),d(g)}},"del")),te.a.createElement("li",{className:"file-words",onClick:function(e){return f(e,o,g)}},"Target: ",v),te.a.createElement("li",{className:"file-modified"},Y(s)),te.a.createElement("li",{className:"file-exports"},te.a.createElement("a",{href:"#txt",onClick:h},"txt"),te.a.createElement("a",{href:"#json",onClick:m},"json"))))},Be=Z.tts,Ge=function(e){function t(e){var n;return Object(re.a)(this,t),(n=Object(ie.a)(this,Object(oe.a)(t).call(this))).readSelected=function(e){e.stopPropagation();var t=n.article,a=t.selected,r=void 0===a?null:a,i=t.texteditor,o=void 0===i?null:i,s=r?document.createElement("article"):o.cloneNode(!0);if(r)for(var c=document.querySelector(".selected");c;)s.appendChild(c.cloneNode(!0)),c=c.nextElementSibling;console.log(s.innerText);var l=new ke(s.children,{filterInactive:!0}).toText();l&&Be.read(l)},n.article=e.article,n.fs=Z.storage("settings"),n.visible=e.visible,n.state={guid:null,current:null,modifiers:{collapsed:!0,strikethrough:!0,typewriter:!1,markdown:!1,dark:!1},values:{fontsize:24,splitwidth:50,readability:0},visible:!1},e.keycapture(/^space/i,"ctrlKey",n.readSelected),n}return Object(se.a)(t,e),Object(le.a)(t,[{key:"componentDidMount",value:function(){var e=this.fs.read();delete e.visible;var t=Object(i.a)({},this.state);for(var n in e&&(t=Object(i.a)({},t,e),this.setState(t)),t.modifiers)console.log(n),this.toggleClassName(n,t.modifiers[n]);for(var a in t.values)this[a]&&(console.log(a,t.values[a]),this[a](t.values[a]))}},{key:"componentDidUpdate",value:function(e){var t={};this.props.current!==e.current&&(t.current=this.props.current),this.props.guid!==e.guid&&(t.guid=this.props.guid),this.props.splitwidth!==e.splitwidth&&(t.values={fontsize:this.state.values.fontsize,splitwidth:this.props.splitwidth}),this.props.visible!==e.visible&&(t.visible=this.props.visible),Object.keys(t).length&&(console.log("settings got new props",t),this.setState(Object(i.a)({},t)),this.save())}},{key:"toggleClassName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"body",a=this.state,r=a.modifiers,i=a.values,o=document.querySelector(n),s=null;s="boolean"===typeof t?t:!r[e];var c=(s=Boolean(s))?"add":"remove";return o.classList[c](e),(e in r||e in i)&&(r[e]=s),null===t&&(this.setState({modifiers:r}),this.save()),!0===s}},{key:"getOnOff",value:function(e){return this.state.modifiers[e]?te.a.createElement("i",{className:"icon-boolean-true"}):te.a.createElement("i",{className:"icon-boolean-false"})}},{key:"getReadabilityLevel",value:function(e){return["Off","very-easy","easy","fairly-easy","plain-english","fairly-difficult","difficult","very-difficult","unknown"][e]}},{key:"readability",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=(e=Number(e))?"add":"remove",r=document.querySelector("body"),i=r.className.replace(/readability-[0-9]/,"");if(r.className=i,r.classList[a]("readability-".concat(e)),r.classList[a]("readability"),n){var o=this.state.values;o.readability=Number(e),this.setState({values:o}),Z.defer("readability",function(){return t.save()},500)}}},{key:"fontsize",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(document.querySelector("body").style.fontSize="".concat(e,"px"),n){var a=this.state.values;a.fontsize=Number(e),this.setState({values:a}),Z.defer("fontsize",function(){return t.save()},500)}}},{key:"save",value:function(){var e=this,t=this.fs;Z.defer("settings",function(){t.write(e.state),t.updateSettings(e.state)},500)}},{key:"render",value:function(){var e=this;return this.state.visible?te.a.createElement("ul",{className:"settings"},te.a.createElement("li",null,te.a.createElement("div",{className:"inner",onClick:function(){e.toggleClassName("dark")}},te.a.createElement("strong",null,"Toggle dark theme"),te.a.createElement("em",null,this.getOnOff("dark")))),te.a.createElement("li",null,te.a.createElement("div",{className:"inner",onClick:function(){e.toggleClassName("collapsed")}},te.a.createElement("strong",null,"Collapse lines"),te.a.createElement("em",null,this.getOnOff("collapsed")))),te.a.createElement("li",null,te.a.createElement("div",{className:"inner",onClick:function(){e.toggleClassName("strikethrough")}},te.a.createElement("strong",null,"Strike through"),te.a.createElement("em",null,this.getOnOff("strikethrough")))),te.a.createElement("li",{className:"no-underline"},te.a.createElement("div",{className:"inner"},te.a.createElement("strong",null,"Font size"),te.a.createElement("em",null,[this.state.values.fontsize,"px","/",Z.points(this.state.values.fontsize),"pt"].join(""))),te.a.createElement("input",{type:"range",id:"fontsize",name:"fontsize",min:"12",max:"48",defaultValue:this.state.values.fontsize,onChange:function(t){var n=t.target.value;e.fontsize(n,!0)}})),te.a.createElement("li",{className:"no-underline"},te.a.createElement("div",{className:"inner"},te.a.createElement("strong",null,"Readability"),te.a.createElement("em",null,this.getReadabilityLevel(Number(this.state.values.readability)))),te.a.createElement("input",{type:"range",id:"readability",name:"readability",min:"0",max:"7",defaultValue:this.state.values.readability,onChange:function(t){var n=t.target.value;e.readability(n,!0)}})),te.a.createElement("li",null,te.a.createElement("div",{className:"inner",onClick:function(){var t=e.article,n=e.toggleClassName("typewriter"),a=t.typewriter(n);a=void 0===n?!a:a,t.typewriter(a)}},te.a.createElement("strong",null,"Typewriter mode"),te.a.createElement("em",null,this.getOnOff("typewriter")))),te.a.createElement("li",null,te.a.createElement("div",{className:"inner",onClick:this.readSelected},te.a.createElement("strong",null,"Read aloud (BETA)"),te.a.createElement("em",null,"stop|start")))):null}}]),t}(te.a.Component),Ke=!1,Fe={width:50,minWidth:10,threshold:15};function Ye(e,t){if(!e)return Fe;var n={};e.constructor!==Object&&void 0!==t&&(n[e]=t,e=Object(i.a)({},n)),Fe=Object(i.a)({},Fe,{key:e})}function Xe(e,t){if(Ke||t){var n=(e||{}).pageX;e&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1);var a=Fe,r=a.threshold,i=a.minWidth,o=window.innerWidth;n=n||(t||50)/100*o;var s=t||Number(n/o*100);s=Math.max(i,s);var c=s=Math.min(100-i,s);qe.classList.remove("hide-content"),He.classList.remove("hide-content"),$e.classList.remove("hide-menu-left"),$e.classList.remove("hide-menu-right"),s<r&&(c=i/o*100,qe.classList.add("hide-content"),$e.classList.add("hide-menu-left")),s>100-r&&(c=100-1.5*i/o*100,He.classList.add("hide-content"),$e.classList.add("hide-menu-right")),qe.style.width="".concat(c,"%"),He.style.width="".concat(100-c,"%"),$e.style.left="".concat(c,"%"),Ue&&Ue(Number(c))}}var _e={};function Qe(e,t){_e[e].innerHTML=t}function Ze(e){Ue=e}function et(e){var t=document.createElement("div");t.id=e,t.className="divider-".concat(e),$e.appendChild(t),_e[e]=t}var tt=function(e,t){return $e=document.querySelector("#vertical"),qe=document.querySelector(".paragraphs"),He=document.querySelector(".sentences"),$e.onmousedown=function(){return Ke=!0},$e.ondblclick=function(e){return Xe(e,50)},t(null,"up",function(){return Ke=!1}),t(null,"move",Xe),Fe.width=e||50,Xe(null,Fe.width),console.log("resizer initialized"),{resize:Xe,settings:Ye,add:et,update:Qe,onResize:Ze}};var nt=function(e){var t=this;if(e){console.log("Sync with server [%s]",e);var n=Z.storage("articles"),a={},r=n.updateArticlesData(),i=r[0].uuid;return r.forEach(function(e){a[e.uuid]=e.modified||e.opened}),n.getUser(e).then(function(t){var o;t&&t.settings&&Z.storage("settings").write(t.settings),i=t.settings&&t.settings.current||i;var s=function(i){if(/settings$/.test(i))return"continue";if((o=t[i].meta).uuid=i,!a[i])return console.log("Create local article [%s]",i),Z.storage(i).write(t[i]),(r=r.filter(function(e){return e.uuid!==i})).push(o),"continue";var s=Z.storage(i).read(),c=t[i];if(s>c)return console.warn("Replace remote data",i,e,void 0),n.updateArticle(e,i,s),"continue";Z.storage(i).write(c)};for(var c in t)s(c)}).then(function(){t.getArticleByGuid(i)}).then(function(){r=n.updateArticlesData(),t.setState({articles:r,guid:e,current:i})})}console.warn("Require sync profile id")};var at=function(){var e=this,t=document.querySelector("html"),n=document.querySelector("body"),a=document.querySelector("#sidebar"),r=[5,a.offsetWidth+50];n.classList.contains("show-sidebar"),this.props.mouse(null,"move",function(i){var o=i.pageX;r[1]=a.offsetWidth+50,!n.classList.contains("show-sidebar")&&o>r[0]||(o>r[1]&&(n.classList.add("sidebar-close"),w("animate",function(){n.classList.remove("sidebar-close"),n.classList.remove("show-sidebar"),t.classList.remove("show-alternative")},250)),o<r[0]&&(e.setState({articles:e.getUpdatedArticles()}),n.classList.add("show-sidebar"),w("sidebar",function(){return o>r[1]?n.classList.remove("show-sidebar"):null},500)))})};var rt=function(e){var t=e.value,n=e.text,a=e.mode,r=e.handler;return te.a.createElement("a",{href:"#show-settings",className:"sidebar-mode-toggle"+(a===t?" selected":""),onClick:function(e){e.preventDefault(),r(t)}},n)},it=Z.storage("settings").read,ot=document.querySelector("html"),st=Z.tts,ct=[];function lt(e,t,n){console.log("register key capture",e,t),ct.push([e,t,n])}window.onkeydown=function(e){ct.some(function(t,n){return t[0].test(e.code)&&e[t[1]]&&t[2](e)})},lt(/^alt/i,"altKey",function(e){var t;if(e.altKey&&("show-alternative",t=ot.classList.contains("show-alternative")?"remove":"add",ot.classList[t]("show-alternative")),e.crtlKey&&"Space"===e.code){e.stopPropagation();var n=(void 0).article,a=n.selected,r=void 0===a?null:a,i=n.texteditor,o=void 0===i?null:i,s=r&&r.innerText.trim()?r:o;if(!s||!s.innerText)return;st.read(s.innerText)}});var ut=function(e){function t(e){var n;Object(re.a)(this,t),(n=Object(ie.a)(this,Object(oe.a)(t).call(this))).saveToDisk=function(){Z.defer("savearticle",function(){var e=n.props.article,t=n.state,a=t.current,r=t.guid,i=t.articles,o=Z.storage(a),s=e.texteditor.children,c=new ke(s).toCollection(),l=i.find(function(e){return e.uuid===a});l||(console.log("No meta data. New article?"),l=o.read().meta);var u={data:c,meta:l};u.meta.modified=(new Date).valueOf(),o.write(u),o.updateArticle(r,a,u);var d=o.updateArticlesData();n.setState({articles:d,current:a,guid:r})},1500)},n.saveDividerWidth=function(e){Z.defer("splitwidth",function(){console.log("save divider width",e),n.setState({splitwidth:e})},750)},n.updateCurrent=function(e){var t=n.state;t.current=e,n.setState(t);var a=document.querySelector("body");a.classList.add("sidebar-close"),Z.defer("animate",function(){a.classList.remove("sidebar-close"),a.classList.remove("show-sidebar")},350)},n.getArticleByGuid=function(e){var t=n.props,a=t.store,r=t.article,i=a.read(e);if(i){var o=i.data,s=i.wordtarget,c=void 0===s?0:s;return r.setWordTarget(c),r.reset(o)}console.warn("No article by that uuid [%s]",e)},n.handleWordTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;e.preventDefault(),e.stopPropagation();var r=e.target,i=Z.storage(a),o=i.read(),s=Z.prompt("Enter a word count target for this document.",t);o.meta.wordtarget=Number(s)||0,i.write(o),i.update(o),r.innerHTML="Target ".concat(s||": add"),console.log("set word targetr",n.state.current,a),n.state.current===a&&(n.props.article.setWordTarget(s),n.props.article.wordcounter())},n.handleDelete=function(e){var t=n.props.store;if(!window.confirm("You are about to delete this file.\nAre you sure?"))return!1;t.delete(e),Z.storage().deleteArticle(e);var a=t.list();e===n.state.current&&a.length&&(e=a[0].uuid,console.log("Delete current. re-initalize editors",e),n.getArticleByGuid(e)),e=a.length?e:null,n.setState({articles:a,current:e})},n.makeEditable=function(e,t,a){e.stopPropagation();var r=n.props.store.rename;return console.log(123,t,a),te.a.createElement("input",{type:"text",defaultValue:t,onBlur:function(e){return r(a,e.target.value)},onKeyPress:function(e){return e.stopPropagation(),/enter/i.test(e.key)&&(e.target.blur(),r(a,e.target.value)),!0}})},n.handleImport=function(e){var t=n.props.store,a=Object(ce.a)(Object(ce.a)(n)),r=a.getArticleByGuid,i=a.updateCurrent,o=Object(ce.a)(Object(ce.a)(n));t.open(e,function(e,n){var a=new ke(n),s=t.create(null,e,a.toCollection()),c=s.meta.uuid,l=o.state.guid;console.log("Import user:[%s] uuid[%s]",l,c,s),r(c),i(c),Z.storage().updateArticle(l,c,s)})},n.handleDataRestore=function(e){var t,a=Z.backupRestore.restore,r=Z.readTextFile,i=Z.storage(),o=i.updateArticle,s=i.updateArticlesData,c=n.state.guid||null,l=e.target.id;r(e).then(function(e){var n=e.result,r=JSON.parse(n),i=Object.keys(r).filter(function(e){return/(articles|settings)$/i.test(e)});if(t=r.settings||{},c=t.guid||c,2!==!i.length){if(Z.confirm("You are about to overwrite existing data.\nAre you sure?"))return a("rewrite",r)}else console.error("Restore failed integrity check",r)}).then(function(e){return s()}).then(function(e){return n.setState({articles:n.getUpdatedArticles()}),document.querySelector("#"+l).value="",e}).then(function(e){c?e.forEach(function(e){var t=e.uuid,n=Z.storage(t).read();o(c,t,n)}):console.log("Cant sync. No username")})},n.download=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"text",t={text:"toText",markdown:"toMarkdown",json:"toCollection"}[e]||"text",a=Object(ce.a)(Object(ce.a)(n)).state;return function(n){n.preventDefault(),n.stopPropagation();var r=!!n.altKey,i=a.current,o=Z.storage(i).read(i),s=o.data,c=o.meta,l=c.name,u=c.uuid,d=(new Date).toISOString().replace(/:\d+.\d+.$/,"").replace("T"," "),f=r?Z.prompt("Enter filename","".concat(l,"-").concat(d)):l;if(l&&l.trim()){var h={name:f,id:u,data:new ke(s)[t](),type:e,appendId:!1};return Z.download(h)}console.log("No file name",i,u,l,s)}};var a=it()||{};return n.defaultData=e.store.initilize(),n.state=Object.assign({},{guid:null,current:null,splitwidth:50,articles:[],mode:0},a,{articles:e.store.list()}),e.article.on("after",null,n.saveToDisk.bind(Object(ce.a)(Object(ce.a)(n)))),e.sentences.on("after",null,n.saveToDisk.bind(Object(ce.a)(Object(ce.a)(n)))),n.syncWithServer=nt.bind(Object(ce.a)(Object(ce.a)(n))),n.registerMouseEvent=at.bind(Object(ce.a)(Object(ce.a)(n))),n}return Object(se.a)(t,e),Object(le.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.state,n=t.guid,a=void 0===n?null:n,r=t.values,i=((void 0===r?null:r)||{}).splitwidth,o=void 0===i?50:i;a&&navigator.onLine?(console.log("SYNC WITH SERVER"),this.props.store.setSyncProfile(a),this.syncWithServer(a)):(console.log("load the default data. no server sync."),this.props.article.init(this.defaultData)),this.mouse=this.props.mouse,this.divider=tt(o,this.mouse),this.divider.add("wordcount"),this.divider.onResize(this.saveDividerWidth),this.props.article.on("wordcounter",null,function(t){return e.updateWordCount(t)}),this.props.sentences.on("wordcounter",null,function(){return e.props.article.wordcounter()}),this.registerMouseEvent()}},{key:"getUpdatedArticles",value:function(){return this.props.store.list()||null}},{key:"updateWordCount",value:function(e){this.divider.update("wordcount",e)}},{key:"getArticles",value:function(){var e=this.getUpdatedArticles();if(e&&e.length){var t,n=this.state.current||e[0].uuid,a=this.props.store,r={getArticleByGuid:this.getArticleByGuid,updateCurrent:this.updateCurrent,handleDelete:this.handleDelete,handleWordTarget:this.handleWordTarget,store:a,downloadText:this.download("text"),downloadJson:this.download("json")};return t=e.map(function(e,t){var a=e.guid||e.uuid,i=a===n?"selected":"";return te.a.createElement("li",{key:a,className:i},te.a.createElement(Ve,{object:e,callbacks:r}))}),te.a.createElement("div",{id:"files"},te.a.createElement("hr",null),te.a.createElement("ul",null,t))}}},{key:"render",value:function(){var e=this;return te.a.createElement("div",{className:"sidebar-content"},0===Number(this.state.mode)?te.a.createElement("div",null,te.a.createElement("ul",{className:"actions"},te.a.createElement("li",null,te.a.createElement("div",{className:"inner",onClick:function(){var t=e.props.store.create(null,"Untitled",[{text:"New document ..."}]);e.getArticleByGuid(t.meta.uuid),e.updateCurrent(t.meta.uuid)}},"New")),te.a.createElement("li",null,te.a.createElement("label",{htmlFor:"uploadInput",className:"inner"},te.a.createElement("span",null,"Open"),te.a.createElement("input",{id:"uploadInput",className:"hidden",onChange:e.handleImport,type:"file",accept:"text/*"}))),te.a.createElement("li",null,te.a.createElement("div",{className:"inner",onClick:e.download("text")},te.a.createElement("span",null,"Save"," ",te.a.createElement("i",{className:"on-alternative-inline"},"As")))),te.a.createElement("div",{className:"on-alternative"},te.a.createElement("li",null,te.a.createElement("div",{className:"inner",onClick:function(){var e=Z.download,t=(0,Z.backupRestore.backup)("rewrite");return e({name:"rewriting-backup",id:(new Date).toISOString(),data:t})}},te.a.createElement("span",null,"Backup"))),te.a.createElement("li",null,te.a.createElement("label",{htmlFor:"restoreData",className:"inner"},te.a.createElement("span",null,"Restore"),te.a.createElement("input",{id:"restoreData",className:"hidden",onChange:e.handleDataRestore,type:"file",accept:"text/json"}))),te.a.createElement("li",null,te.a.createElement("div",{className:"inner",onClick:function(){var t=Z.prompt("Enter your sync id:");e.syncWithServer(t),console.log("state",e.state)}},te.a.createElement("span",null,"Sync Profile"),te.a.createElement("em",null,e.state.guid||"Not syncing"))))),e.getArticles()):null,function(t){return te.a.createElement("div",{className:"sidebar-settings"},te.a.createElement(Ge,{article:e.props.article,guid:e.state.guid,current:e.state.current,keycapture:lt,visible:t,splitwidth:e.state.splitwidth}))}(1===Number(this.state.mode)),te.a.createElement("div",{className:"sidebar-mode-switch"},te.a.createElement(rt,{text:"files",handler:function(t){return e.setState({mode:0})},mode:this.state.mode,value:0}),te.a.createElement(rt,{text:"settings",handler:function(t){return e.setState({mode:1})},mode:this.state.mode,value:1})))}}]),t}(te.a.Component),dt=(n(28),{up:[],move:[]});function ft(e,t,n){if(n)return dt[t].push(n);dt[t].forEach(function(t){return t(e)})}window.onmouseup=function(e){return ft(e,"up")},window.onmousemove=function(e){return ft(e,"move")};var ht=new Je(Z.storage.bind(window)),mt=new Ne("c1",{prefix:"a",hidden:!0}),vt=new Le("c2",{prefix:"s",hidden:!0});mt.bindTo(vt),vt.bindTo(mt),window.RE={storage:ht,article:mt},setTimeout(function(){document.querySelector(".container").classList.remove("hidden"),document.querySelector(".sidebar").classList.remove("hidden"),document.querySelector(".overlay").classList.add("hidden")},1e3);var gt=document.querySelector("#sidebar");ae.a.render(te.a.createElement(ut,{store:ht,article:mt,sentences:vt,mouse:ft}),gt);var pt=document.querySelector("#overlay");ae.a.render(te.a.createElement("div",{className:"brand"},te.a.createElement("img",{src:"./static/images/rewriting.svg",alt:"writing is rewriting"})),pt)}},[[15,1,2]]]);
//# sourceMappingURL=main.d5c54582.chunk.js.map