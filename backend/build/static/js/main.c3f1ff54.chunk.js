(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(e,t,n){e.exports=n(24)},22:function(e){e.exports={meta:{name:"Startup example",uuid:"a0123456789abcde"},data:[{text:"# Re:writing"},{text:""},{text:"Writing is rewriting."},{text:""},{text:"This is a simple tool, which allows the writer, to systematically breakdown each paragraph into component sentences, iterate over them until the paragraph is complete.",versions:[">This is a crude tool",">A new way to rewrite","This is a simple tool,",">",">and it allows the student,",">that empowers the the author,","which allows the writer,",">",">to systematically breakdown each paragraph into component sentences, and iterate over new versions until the paragraph is complete.","to systematically breakdown each paragraph into component sentences, iterate over them until the paragraph is complete.",""],locked:"locked",className:"className"},{text:""},{text:"The interface is split into two parts which can be resized, and there is a file and settings menu on the left, which remains hidden, to keep the work area clean."},{text:""},{text:"To open the menu move your mouse to the left edge of the screen. The menu will open to reveal various self explanatory preferences.",selected:"selected"}]}},23:function(e,t,n){},24:function(e,t,n){"use strict";n.r(t);var r=n(1);var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:">",n=Object(r.a)(e).map(function(e){var t=e.classList.contains("inactive");return{text:"".concat(e.innerText).trim(),hidden:t}}).map(function(e){var n=e.hidden?t:"",r=e.text;return"".concat(n).concat(r)});return Object(r.a)(n)},i=n(2),o=0,s=0;var c=function(){return((o+=1)%6+10).toString(16)+(new Date).valueOf().toString(16)+(1e3+(s+=1)%999)+""},l=/(\.|:|!|\?|"|\))$/g;var u=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e=e&&e.trim()){var n=l.test(e),r=t&&!n?".":"";return"".concat(e).concat(r)}};var d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e){var t=e.trim();return/\r/.test(e)&&(t=t.replace(/\r/gm,"")),t=(t=(t=(t=t.split(/\n{2,}/gm)).map(function(e){return e.replace(/\n+/g," ").replace(/\s{2,}/g," ").trim()||""})).join("\n\n")).split(/\n/g),Object(r.a)(t)}},f=/^([\/>?=!]\s*?)/;var h=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"";var n=e&&e.constructor===Array?e:d(e);return Object(r.a)(n).map(function(e){return f.test(e)?null:u(e,t)}).filter(function(e){return e&&e.length}).join(" ").trim()},m={re:{lineEnd:/(^\w|[.?!;]\s+\w)/g,newLine:/^-{3,}/,commentChars:/^(\s+)?[>?!\/]+(\s+)?/,passiveKeys:/^(arrow|shift|control|alt|tab)/i},timer:{default:100,delay:0},options:{flag:"inactive",re:/^(\s+)?[>?!\/]+(\s+)?/,tag:"p",br:"<br/>",markdown:!1,scrollToSelected:!0}},v=function(e,t){if(!e)return;var n=Object(i.a)({},m.options,{options:t}),r=n.tag,a=n.br,o=n.re,s=n.flag,l=!0,u=e.map(function(e){var t={},n={},i={},u=/^(text|versions|locked|selected|html|classnames)/i,d=e.text,f=void 0===d?"":d,m=e.versions,v=void 0===m?"":m,g=e.selected,p=void 0===g?"":g,w=v?c():"",y=v&&h(v),b=f||y||"",k=v?JSON.stringify(v):"",O=!(!v||y),E=o.test(b)||e.inactive;t.locked=!!v||null,t[s]=!!E||null,t.selected=!(!l||!p)||null,t.empty=!!O||null,Object.keys(e).forEach(function(r){if(!(u.test(r)||r in t))return/^m-/i.test(r)?/^(true)$/i.test(e[r])?n[r]=!0:i[r]=JSON.stringify(e[r]):void(t[r]=!0)}),e&&e.classnames&&e.classnames.forEach(function(e){t[e]=!0}),t=Object.keys(t).map(function(e){return t[e]?e:""}).join(" ").trim()||null,l=!p&&l,i=Object.keys(i).map(function(e){return"data-".concat(e,"='").concat(i[e],"'")}),i=(i=" ".concat(i.join(" "))).trim()?" ".concat(i):"";var j={};j.id=w?' id="'.concat(w,'"'):"",j.className=t?' class="'.concat(t,'"'):"",j.dataset=v?" data-versions='".concat(k,"'"):"",j.innerHTML=b.replace(o,"")||a,n=Object.keys(n).map(function(e){return"".concat(e,'=""')}),n=(n="".concat(n.join(" "))).trim()?" ".concat(n):"";var S=document.createElement(r);return S.id=w,S.dataset.versions=JSON.stringify(y),"<".concat(r).concat(j.id).concat(j.className).concat(n).concat(i).concat(j.dataset,">").concat(j.innerHTML,"</").concat(r,">")});/<br\s?\/?>/i.test(u.slice(-1))||u.push("<".concat(r,">").concat(a,"</").concat(r,">"));return u.join("\n")};var g=n(13),p=n.n(g),w={};var y=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e&&t){w[e]||(w[e]={ns:e,fn:t,ms:n,t:null,n:0,verbose:!0===r});var a=(!1).verbose,i=void 0!==a&&a;w[e].n+=1,i&&console.log("CALLING REGISTER [%s]",e,w[e].n),clearTimeout(w[e].t),w[e].t=setTimeout(function(){return i&&console.log("EXECUTING REGISTER [%s]",e,w[e].n),delete w[e],t()},n)}},b=n(10),k={json:["json","json"],text:["text","txt"],markdown:["text","md"]};var O=function(e){var t=e.name,n=e.id,r=e.data,a=e.type,i=void 0===a?"json":a,o=e.appendId,s=void 0===o||o,c=Object(b.a)(k[i],2),l=c[0],u=c[1],d=s?"-".concat(n):"",f="".concat(t).concat(d,".").concat(u),h="json"===i?JSON.stringify(r):r,m=document.createElement("a"),v=encodeURIComponent(h);m.setAttribute("href","data:text/".concat(l,";charset=utf-8,").concat(v)),m.setAttribute("download","".concat(f)),m.style.display="none",document.body.appendChild(m),m.click(),document.body.removeChild(m)};var E=function(e,t,n){var a=document.querySelectorAll(".".concat(t));return Object(r.a)(a).forEach(function(e){return e.classList.remove(t)}),e.setAttribute("tabindex","-1"),e.classList.add(t),e.focus(),n&&n()},j=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{e=e.replace(/'/g,"\u2019"),t=JSON.parse(e)}catch(r){console.error("JSON parse Error!\nUsing alternative:[%s]",n),console.log(r),t=n}return t};var S=function(e){var t=/<[^<]+>/gi;return Object(r.a)(e).map(function(e){var n=e.innerText,a=void 0===n?"":n,i=e.innerHTML,o=e.dataset,s=e.nodeName,c=e.classList;if(!/(div|p)/i.test(s))return null;var l=a&&a.trim()||i&&i.replace(t,""),u=o.versions&&j(o.versions,l),d={};return d.text=l||"",u&&(d.versions=u),Object(r.a)(c).forEach(function(e){return d[e]=e}),d}).filter(function(e){return e})},T=n(9),N=n.n(T);var x=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=N.a.sentences(e);return t?n:n.join("\n")},C={confirmDelete:"\nYou are unlocking this paragraph. \n\nThis will delete the working versions and destill \nthe paragraph to the currently elected candidate.\n\n[CANCEL] to keep working versions\n[OK] to discard versions\n"};var L=function(e,t){var n=e.currentTarget.files,r=new FileReader,a=n[0],i=a.name;r.onload=function(e){var n=e.target.result;return t(i,n)},r.readAsText(a)};var A=function(e){if(e){var t=e.innerText,n=e.dataset,r=n.versions;return e.classList.remove("empty"),t.replace(/^\(empty\)$/,"")||(e.classList.add("empty"),t="(empty)"),t=t?N.a.sentences(t):[""],n.versions?j(r):t}};var D,I,P,R,z,J=function(e){var t=e.toLowerCase(),n=e.toUpperCase();return e=e!==n?n:t.replace(/(^\w|[.?!;]\s+\w)/g,function(e,t){return e.toUpperCase()})},W=/^en-(uk|gb)/i,M=null;function q(){if(R=window.speechSynthesis,z=R.getVoices(),I=I||navigator.languages,!z)return P&&clearTimeout(P),P=setTimeout(q,150);var e=null;console.log(z.length,I),z=z.filter(function(e){return e.lang.indexOf(I[1])+1}),e=(D=z.filter(function(e){return W.test(e.lang)})).length&&D.findIndex(function(e){return/female/gi.test(e.name)}),e=Math.max(e,0),console.log("TTS initialized",D.length,e),M=D.length?D[e]:z[0],console.log("selectedVoice",M)}function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=new SpeechSynthesisUtterance,r=M||null;return r?(Object.assign(n,{volume:1,pitch:1,rate:1,voice:r,text:e}),R.speak(n)):setTimeout(function(){console.warn("Say this is not ready. Reloading."),q(),U(e,t)},450)}var $={say:U,read:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(R||q(),R.speaking)return R.cancel();if(e){var n=e.constructor===Array?e:e.split("\n");n=(n=(n=n.filter(function(e){return String(e||"")})).map(function(e){return e.replace(/[\u201c\u201d_]+/gm,"")})).map(function(e){return e.split(/[.]/g)}),n=[].concat.apply([],n),console.log("Total sentences [%s]",n.length),n.forEach(function(e,n){return U("".concat(e).concat(t),n)})}},voice:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return D&&D.length||q(),M=D[e]},speaking:function(){return window.speechSynthesis.speaking},cancel:function(){return window.speechSynthesis.cancel()}};window.TTS=$;var H=q;var B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=e;return n=(n=(n=(n=n.split(/\n{2,}/gm)).map(function(e){return t?function(e,t){var n="";return e.split(/\n/g).forEach(function(e){var r=String(e||"").trim(),a=t.some(function(e){return e.test(r)});r&&(n+=a?"\n".concat(r,"\n"):"".concat(r," "))}),n.replace(/\n{2,}/,"\n").trim()}(e,t):e.replace(/\n+/g," ").replace(/\s{2,}/g," ").trim()||""})).join("\n\n")).split(/\n/g),Object(r.a)(n)};var V=function(e){return(e=String(e||""))&&(e=(e=(e=(e=e.replace(/(\w)[-]+(\w)/g,"$1$1")).replace(/[\W"]+/g," ")).replace(/(\s{1,})/g," ")).trim()).length?e.split(" ").length:0},G=window.localStorage;var K={context:function(e){G=e},backup:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=null,n=new RegExp("^".concat(e));return Object.keys(G).filter(function(e){return n.test(e)}).forEach(function(e,r){var a=e.replace(n,"");(t=t||{})["BAK-".concat(a)]=G[e]}),t},restore:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;if(t){var n=e?"".concat(e,"-"):"",r={articles:[],settings:{}};Object.keys(t).forEach(function(e,n){var a=e.replace(/(^[^-]+-+)/,""),i=t[e],o=/^[[{'"]/.test(i)?JSON.parse(t[e]):i,s=(new Date).valueOf();if(/[a-z0-9]{16}$/.test(e))return"data"in o||"meta"in o||(o={meta:{uuid:a,name:"Untitled ".concat(n),username:null,created:s,modified:s,wordtarget:0},data:o}),void(r[a]=o);/(settings|articles)$/i.test(a)&&(r[a]=o)});var a=[];r.articles.forEach(function(e,t){var n=e.uuid||e.guid;r[n].meta=Object(i.a)({},e),r[n].meta.uuid=n,r[n].meta.modified=e.opened||e.modified,a.push({uuid:n,modified:e.opened||e.modified,created:e.created,name:e.name})}),r.articles=a;var o=r.settings,s=o.previous,c=o.current;return r.settings.current=s||c,delete r.settings.previous,delete r.settings.settings,Object.keys(r.settings).forEach(function(e){/^[0-9]+$/.test(e)&&delete r.settings[e]}),Object.keys(r).forEach(function(e){return G["".concat(n).concat(e)]=JSON.stringify(r[e])}),G}},purge:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object.keys(G).forEach(function(t){return t.indexOf(e)+1?delete G[t]:null})},keys:function(){return Object.keys(G)}};var F=function(e){if(e&&"number"===typeof e){var t=Math.round(.75292857248934*e);return t=parseInt(t,10)}};function Y(e){return!(!e||"Invalid Date"===e||isNaN(e))}var X=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t=t||new Date,!Y(e="string"===typeof e?new Date(Number(e)):new Date(e))||!Y(t)||e>t)return null;if(t.valueOf()-e.valueOf()<3e4)return"Now";var n,r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=e.toString().split(/[\s:]/g);e=e.valueOf();var r=(t=t||(new Date).valueOf())-e,a=Object(b.a)(n,9),o=a[0],s=a[1],c=a[2],l=a[3],u=a[4],d=a[5],f=a[6],h=a[7],m=a[8],v="".concat(u,":").concat(d),g=[{name:"milisecond",value:1},{name:"second",value:1e3},{name:"minute",value:60},{name:"hour",value:60},{name:"day",value:24},{name:"week",value:7},{name:"month",value:52/12},{name:"year",value:12}];g.reduce(function(e,t){return t.diff=e/t.value,e/t.value},r);var p=g.filter(function(e){return e.diff>=1}),w=g[p.length-1];return Object(i.a)({},w,{time:v,weekday:o,month:s,day:Number(c),year:Number(l),hour:Number(u),minute:Number(d),second:Number(f),offset:h,tz:m})}(e,t);switch(r.diff=parseInt(r.diff),r.name){case"milisecond":n="Now";break;case"second":if(r.diff<30){n="Now";break}n="".concat(parseInt(r.diff)," seconds ago");break;case"minute":if(r.diff<2){n="A minute ago";break}n="".concat(parseInt(r.diff)," minutes ago");break;case"hour":if(r.diff<2){n="An hour ago";break}if(r.diff<12){n="".concat(r.diff," hours ago");break}n="At ".concat(r.time);break;case"day":if(r.diff<2){n="Yesterday at ".concat(r.time);break}n="".concat(r.weekday," at ").concat(r.time);break;case"week":if(r.diff<2){n="Last ".concat(r.weekday," at ").concat(r.time);break}n="".concat(r.weekday," ").concat(r.day," ").concat(r.month," at ").concat(r.time);break;case"month":if(Number(r.year)===t.getFullYear()){n="".concat(r.weekday," ").concat(r.day," ").concat(r.month," at ").concat(r.time);break}default:n="".concat(r.day," ").concat(r.month," ").concat(r.year," ").concat(r.time)}return n},_=document.location.origin;_=/localhost/i.test(_)?_.replace(/[0-9]+$/,"5000"):_,console.log("API origin",_);var Q={settings:"".concat(_,"/api/v1.0/settings/"),article:"".concat(_,"/api/v1.0/article/"),user:"".concat(_,"/api/v1.0/user/")};var Z=function(){var e=["rewrite",arguments.length>0&&void 0!==arguments[0]?arguments[0]:null].filter(function(e){return e}).join("-"),t=window.navigator.onLine,n=this.localStorage||window.localStorage;return{data:function(){return n},delete:function(){delete n[e]},pull:function(e,n){t||n(null),console.log("pull from api %s (%s)",e,Q.user),fetch("".concat(Q.user).concat(e),{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){var t=Object(i.a)({},e.settings),r=t.previous||t.current||null,a=Object.keys(e).filter(function(e){return/^[a-z0-9]{16}/.test(e)}).map(function(t){return e[t].meta});delete e.settings;var o=Object(i.a)({},e,{settings:t,articles:a,previous:r});n({status:200,data:o})})},getUser:function(e){if(t)return fetch("".concat(Q.user).concat(e),{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()});console.log("not online")},deleteArticle:function(e){t?e?fetch("".concat(Q.article).concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(console.log):console.error("property missing [%s]",e):console.log("not online")},updateArticle:function(e,n,r){t?e&&n&&r?fetch("".concat(Q.article).concat(e,"/").concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(function(e){return e.json()}).then(function(t){return console.log(t,e,n)}):console.error("property missing [%s] [%s]",e,n,r):console.log("not online")},updateSettings:function(e){var t=e.guid;t?fetch("".concat(Q.settings).concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){return console.log(e)}):console.warn("Cant push settings. No username",e)},update:function(e){var t=e.uuid;fetch("".concat(Q.article).concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){return console.log(e)})},push:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t){if(e)return console.log("push to api %s",e,Q.settings,Q.article),y("push",function(){var t={};Object.keys(n).filter(function(e){return/^rewrite/i.test(e)}).map(function(e){var r=e.replace(/^([^-]+-+)/,"");return t[r]=n[e],e});var r={};t.settings=JSON.parse(t.settings),Object.keys(t.settings).filter(function(e){return/^([a-z]+)$/i.test(e)}).forEach(function(e){/^settings/i.test(e)||(r[e]=t.settings[e])}),fetch("".concat(Q.settings).concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(function(e){return e.json()}).then(function(e){return console.log(e)}),console.log(t.articles),JSON.parse(t.articles).forEach(function(n){var r=n.guid||n.uuid,a={meta:{uuid:r,username:e,created:n.created,modified:n.modified||n.opened,name:n.name,wordtarget:n.wordtarget},data:JSON.parse(t[r])};fetch("".concat(Q.article).concat(e,"/").concat(r),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(function(e){return e.json()}).then(function(e){return console.log(e)})})},r||1e4);console.log("no guid")}else console.log("not online")},backup:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r="".concat(e,"-backup"),a={averages:[],datas:[]},i=t||(new Date).valueOf();return y(r,function(){var t=n[e]||null,o={tag:i,data:t},s=0,c=n[r]||null,l=[99],u=[o];if((c=c?JSON.parse(c):a).datas.length){s=c.datas.length-1;var d=JSON.stringify(o),f=JSON.stringify(c.datas.slice(-1)),h=Math.min(d.length,f.length),m=Math.max(d.length,f.length),v=parseInt(h/m*100,10),g=v/(c.averages.reduce(function(e,t){return e+Number(t||0)})/c.averages.length)*100<78;g?(console.warn("Insert backup. [%s] (%s)",g,78),c.datas.push(o)):(c.averages.push(v),c.datas[s]=o),l=c.averages.slice(-25),u=c.datas}c={averages:l,datas:u},n[r]=JSON.stringify(c)},1e3)},read:function(t){var r=n[e]||null,a=r&&/^[[{"]/.test(r)?JSON.parse(r):r;return t&&t.construcor===Function?t(a):a},write:function(t){var r=function(){return n[e]=JSON.stringify(t)};return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?y(e,r,250,!0):r()}}},ee={alert:function(e){return window.alert(e)},confirm:function(e){return window.confirm(e)},prompt:function(e,t){return window.prompt(e,t)},backupRestore:K,childrenToVersionArray:a,collectionToHtml:v,deepEqual:p.a,defer:y,elapsed:X,download:O,focusOn:E,htmlToCollection:S,inflate:x,jsonParseSafe:j,message:function(e){return C[e]||"WARNING:\n\nCan't find [".concat(e,"] message.")},points:F,readTextFile:L,selectedValueArray:A,storage:Z,time:function(){return(new Date).toString().replace(/.* (\d+:\d+:\d+) .*/g,"$1")},toggleStringCase:J,tts:H,unwrap:B,uuid:c,wordcount:V};var te=n(0),ne=n.n(te),re=n(11),ae=n.n(re),ie=n(3),oe=n(7),se=n(5),ce=n(8),le=n(6),ue=n(4);var de=function(){var e=this.texteditor;e.onkeydown=function(e){var t=this,n=this.re.passiveKeys.test(e.key);if(this.selected&&this.selected.dataset.versions&&!n)return console.log("versions and NOT passive"),!1;var r=this.updateKeysPressed(e,!0),a=Object.keys(this.triggers).find(function(e){var n=t.triggers[e],a=n.re,i=n.fn;return a&&a.test(r)?i:null});return console.log("ONKEYDOWN",e.key,e.code,r),this.trigger(a,e)}.bind(this),e.onkeyup=function(e){var t=this;this.deselect();var n=this.re.passiveKeys.test(e.key),r=e.type,a=e.key,i=window.getSelection().focusNode,o=i.parentNode.nodeName,s=i.parentNode;if(/^enter/i.test(a))return i.id="",void this.deselect();if("P"===o){var c=s.innerText;if(!c||!c.trim())return console.log("no inner text"),void this.deselect();this.setSelected(s),console.log("ONKEYUP [%s] <%s>",r,o,a);var l=this.timer.after;this.timer.delay=n?25:this.timer.default,this.defer("change",function(){return t.triggers.change.fn.call(t,e)}),this.wordcounter(),this.defer("after",function(){return t.triggers.after.fn.call(t)},l)}else console.log("not P tag",r)}.bind(this),e.onclick=function(e){this.deselect(),this.setSelected(e.target),this.triggers.click&&this.triggers.click.fn.call(this,e)}.bind(this)};var fe=m.options;var he,me=function(e,t){if(t&&(fe=Object(i.a)({},fe,t)),e){var n=fe,a=n.flag,o=n.re,s=n.tag,c=n.br;return Object(r.a)(e).map(function(e){var t="".concat(e).replace(o,"").trim()||c;t="string"!==typeof e?c:t;var n=[];return o.test(e||"")&&n.push(a),n=(n=n.length?n.join(" "):null)&&' class="'.concat(n,'"')||"","<".concat(s).concat(n,">").concat(t,"</").concat(s,">")}).join("\n")}},ve=null,ge=[],pe=function(e,t){var n=e.key.trim()||e.code;return ge.push(n),ve&&clearTimeout(ve),ve=setTimeout(function(){return ge=[]},250),t?ge.join(""):Object(r.a)(ge)},we=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:/^>/;arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.map(function(e){var n="string"===typeof e?{html:null,text:"".concat(e).trim(),inactive:t.test(e),classnames:[]}:e;return n})};var ye=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(ie.a)(this,e),this.options=Object(i.a)({flag:"inactive",re:/^(\s+)?[>?!\/]+(\s+)?/,unwrap:!0,tag:"p",br:"<br/>",markdown:!1},n),t||(t=""),t.data&&(console.warn("Coersing data from Object"),t=t.data);var a=this.options,o=a.re,s=a.unwrap,c=a.markdown,l=t.constructor,u=(l===Object?"object":l===String&&"string")||l===Array&&"array"||l===HTMLCollection&&"html"||"unknown";switch("object"===u&&t.data&&(console.warn("Coerse data array"),u="array",t=t.data),u){case"string":t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";/\r/.test(e)&&(e=e.replace(/\r/gm,""));return e}(t),t=s?B(t):t.split(/\n/g),t=we(t,o,c);break;case"array":t=we(t,o,c);break;case"html":t=S(t);break;default:console.error("WARNING! switch fallthrough for",u,l,t)}he=Object(r.a)(t)}return Object(ue.a)(e,[{key:"toHTML",value:function(){var e=this.options;return v.call(this,he,e)}},{key:"toText",value:function(){var e=be(he).join("\n");return e=e.replace(/(\s+)?$/g,"")}},{key:"toArray",value:function(){return be(he)}},{key:"toCollection",value:function(){return he}}]),e}();function be(e){return Object(r.a)(e).map(function(e){return"".concat(e.text)})}var ke=function(){Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;var t=this.parentNode,n=window.getComputedStyle(t,null),r=parseInt(n.getPropertyValue("border-top-width")),a=parseInt(n.getPropertyValue("border-left-width")),i=this.offsetTop-t.offsetTop<t.scrollTop,o=this.offsetTop-t.offsetTop+this.clientHeight-r>t.scrollTop+t.clientHeight,s=this.offsetLeft-t.offsetLeft<t.scrollLeft,c=this.offsetLeft-t.offsetLeft+this.clientWidth-a>t.scrollLeft+t.clientWidth,l=i&&!o;(i||o)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-r+this.clientHeight/2),(s||c)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-a+this.clientWidth/2),(i||o||s||c)&&!e&&this.scrollIntoView(l)})};document.execCommand("defaultParagraphSeparator",!1,"p");var Oe=function(){function e(t,n){var r=this;Object(ie.a)(this,e),this.wordcounter=function(e){r.defer.call(r,"wordcounter",function(){var t,n;e=e||r.triggers.wordcounter.fn;var a=r.texteditor.innerText;(r.words=V(a),t='<span class="value">'.concat(r.words,"</span>"),r.wordtarget)&&(n=r.wordtarget-r.words,t='<span class="value value'.concat(n<0?"-warn":"",'">').concat(r.words,"/").concat(r.wordtarget,"</span>"));return e(t)},150)},this.init=function(e){if(e){var t=new ye(e,{markdown:r.markdown});r.texteditor.innerHTML=t.toHTML(),r.show(),r.focus(),r.wordcounter();var n,a=r.texteditor.querySelector(".selected");a&&(r.setSelected(a),n=a.dataset.versions?JSON.parse(a.dataset.versions):x(a.innerText),r.parent.init(n))}};var a=document.getElementById(t),i=document.createElement("article");i.setAttribute("contenteditable",""),i.setAttribute("spellcheck","true"),a.innerHTML="",a.appendChild(i),this.id=t,this.parent=null,this.keytime=null,this.selected=null,this.markdown=null,this.scrollToSelected=!0,this.words=0,this.wordtarget=0,this.container=a,this.texteditor=i,this.data={},this.triggers={click:{fn:function(e){return console.warn("Default event. CLICK [%s]",e)}},change:{fn:function(e){return console.warn("Default event. CHANGE [%s]",e)}},after:{fn:function(e){return console.warn("Default event. AFTER [%s]",e)}},wordcounter:{fn:function(){}}},Object.assign(this,m,n);var o=this.hidden,s=void 0!==o&&o;de.bind(this)(),this.defer=y.bind(this),this.uuid=c.bind(this),this.arrayToHtml=me.bind(this),this.updateKeysPressed=pe.bind(this),Element&&!Element.scrollIntoViewIfNeeded&&ke(),this.init(),this.show(!s)}return Object(ue.a)(e,[{key:"bindTo",value:function(e){this.parent=e}},{key:"show",value:function(e){e=void 0===e||Boolean(e),this.hidden=!0!==e,this.container.classList[this.hidden?"add":"remove"]("hidden")}},{key:"trigger",value:function(e,t){if(e&&this.triggers[e]){var n=this.triggers[e],r=n.fn,a=n.data,i=r.call(this,t);return a&&a.constructor===Function&&(console.log(i,a),a.call(this,i)),i}}},{key:"on",value:function(e,t,n,r){this.triggers[e]={re:t,fn:n,data:r}}},{key:"deselect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"selected",t=this.texteditor.querySelectorAll(".".concat(e));Object(r.a)(t).forEach(function(t){return t.classList.remove(e)}),this.selected=null}},{key:"setSelected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e.id,n=e.innerText;if(n&&n.trim()){e.id=t||this.uuid(),e.classList.add("selected");var r=e.dataset&&e.dataset.versions?"add":"remove";e.classList[r]("locked"),this.selected=e}else console.warn("Element has no innerText value")}},{key:"focus",value:function(){var e=document.querySelector("p.selected");this.scrollToSelected&&e&&e.scrollIntoViewIfNeeded()}},{key:"toggleMarkdown",value:function(){this.markdown=!1}},{key:"setWordTarget",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.wordtarget=e}},{key:"reset",value:function(e){if(this.parent.texteditor.innerText="",this.texteditor.innerText="",this.parent.selected=null,this.selected=null,this.words=0,this.data={},e.meta){console.warn("Reduce article to data",e);var t=e.meta.wordtarget,n=void 0===t?null:t;this.wordtarget=n,e=e.data}this.init(e)}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;console.log("UPDATE [%s]\n",e,this.markdown);var t=this.selected,n=this.re,a=n.newLine,i=n.commentChars;if(t&&e){t.dataset.versions=JSON.stringify(e);var o=e.map(function(e){var t=a.test(e)?"\n\n":e;return t=i.test(t)?"":t,"".concat(t).trim()}).filter(function(e){return e&&e.trim()}).join(" ").trim();if(Object(r.a)(t.classList).forEach(function(e){return/^md/.test(e)&&t.classList.remove(e)}),this.markdown&&o){var s=we([o],i,!0)[0];t.dataset.text=o,o=s.html||"",s.classnames&&s.classnames.length&&s.classnames.forEach(function(e){return t.classList.add(e)})}return t.classList[o?"remove":"add"]("empty"),t.classList.add("locked"),t.classList.add("selected"),t.innerHTML=o||"(empty)",t}}}]),e}(),Ee=function(e){function t(e,n){var r;return Object(ie.a)(this,t),(r=Object(oe.a)(this,Object(se.a)(t).call(this,e,n))).on("click",null,Te),r.on("toggle",/^(altalt)$/i,Te),r.on("collapse",/^(shiftshift)$/i,je),r.on("change",null,Se),r.on("typewriter",/(home|end|page|arrow|delete|backspace)/i,Ne),r.typewriter=function(){var e=!1;return function(t){return e="boolean"===typeof t?t:e}}.call(Object(ce.a)(r)),r}return Object(le.a)(t,e),t}(Oe);function je(){this.selected?this.selected.classList.toggle("inactive"):console.warn("no selected paragraph")}function Se(){var e=ee.selectedValueArray(this.selected);this.parent.init(e)}function Te(e){if(e&&(e.preventDefault(),e.stopPropagation(),console.log(e.code)),this.selected){var t=ee.selectedValueArray(this.selected),n=this.selected,r=n.classList,a=n.dataset,i=this.selected.dataset.versions,o=i&&i.trim();return/^key/.test(e.type)&&o&&window.confirm("Are you sure")&&(r.remove("locked"),a.versions="",t=[""],this.selected.classList.contains("empty"))?(this.selected.innerText="",this.selected.className="",this.selected.remove(),this.selected=null,this.parent.init([""]),!1):(this.parent.init(t),!1)}console.log("no selected element")}function Ne(e){if(this.typewriter())return e.preventDefault(),!1}var xe=function(e){function t(e,n){var r;return Object(ie.a)(this,t),(r=Object(oe.a)(this,Object(se.a)(t).call(this,e,n))).arrayToHtml(null,{hidden:!0}),r.on("change",null,De),r.on("toggle",/^(shiftshift)$/i,Ie),r.on("capitalize",/^(altenter)$/i,Ae),r.on("newline",/^(shiftenter)$/i,Ce),r.on("deleteline",/^(altbackspace)$/i,Le),r.on("click",null,function(){}),r}return Object(le.a)(t,e),t}(Oe);function Ce(e){e.preventDefault(),e.stopPropagation();var t=this.selected,n=document.createElement("p"),r=document.createElement("br"),a=window.getSelection(),i=document.createRange();return t.parentNode.insertBefore(n,t.nextSibling),n.appendChild(r),i.setStart(r,0),i.collapse(!0),a.removeAllRanges(),a.addRange(i),!1}function Le(e){e.preventDefault(),e.stopPropagation(),console.log(e.target),this.selected.remove()}function Ae(){var e=this.selected.innerText;this.selected.innerText=ee.toggleStringCase(e)}function De(){var e=this.texteditor.children,t=ee.childrenToVersionArray(e);this.parent.update(t)}function Ie(e){this.selected.classList.toggle("inactive")}var Pe=n(22),Re=function(){function e(t){Object(ie.a)(this,e),this.key=null,this.articles=this.list,this.storage=t,this.uuid=c,this.current=null,this.syncId=null,this.timestamp=null,this.create=function(e,t,n){if(!n)return void console.error("Create requires article schema");e=e||c(),t=t||"Untitled";var r=(new Date).valueOf(),a=(new Date).valueOf(),i={uuid:e,name:t,created:r,modified:a},o=this.storage("articles"),s=o.read()||[],l=s.findIndex(function(t){return t.uuid===e});s&&s.length&&l+1&&(console.warn("UUID exists. Replace %s",e),s.splice(l,1));s.push(i),o.write(s),this.current={meta:i,data:n};var u=this.filename(e);return this.storage(u).write(this.current),this.current}.bind(this)}return Object(ue.a)(e,[{key:"filename",value:function(e,t){if(e)return[t,e].filter(function(e){return e}).join("-")}},{key:"setSyncProfile",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;console.log("Profile Sync",e),this.syncId=e,this.timestamp=(new Date).valueOf()}},{key:"read",value:function(e){if(!e)return this.current=null,null;var t=this.storage,n=this.filename,r=t("settings"),a=t(n(e)).read();if(!a)return this.current=null,null;if(!a.meta||!a.data)return console.error("This article has incorrect schema. Missing meta and data"),null;var i=r.read()||{};return i.current=a.meta.uuid,r.write(i),this.current=a}},{key:"write",value:function(e){if(!e)return null;console.log("write to filesystem",this.syncId);var t=this.current,n=this.filename,a=this.storage,o=t&&t.guid;if(!o)return console.log("no current guid"),null;var s=a(n(o));s.write(e,!0),s.backup();var c=a("articles"),l=c.read(),u=l.findIndex(function(e){return e.guid===o}),d=l.splice(u,1)[0];return d.opened=(new Date).valueOf(),l=[d].concat(Object(r.a)(l)),c.write(l,!0),this.current=Object(i.a)({},this.current,{data:e}),this.current}},{key:"import",value:function(e){}},{key:"export",value:function(){}},{key:"list",value:function(e){return this.storage("articles").read()}},{key:"open",value:function(e,t){return e||console.error("Cant open, require files array"),L(e,function(e,n){return t(e,n)})}},{key:"save",value:function(e){if(this.current){var t=this.current,n=t.guid,r=t.name,a=t.data;return O({id:n,name:e||r,data:a})}console.error("No current article to download")}},{key:"rename",value:function(e,t){if(e&&t){var n=this.list(),r=n.findIndex(function(t){return t.uuid===e}),a=this.storage("articles");return n[r].name=t,a.write(n),!0}}},{key:"delete",value:function(e){if(!e)return console.log("Cant delete [%s]",e),!1;var t=this.storage,n=(this.current||{}).meta,r=void 0===n?null:n,a=this.list().filter(function(t){return t.uuid!==e});return t("articles").write(a),t(e).delete(),r&&r.uuid===e&&(console.warn("Deleting current article %s",e),this.read(this.list()[0].uuid)),!0}},{key:"initilize",value:function(){var e=Pe.meta.uuid,t=Pe.meta.name,n=this.storage("settings"),r=(n.read()||{}).current,a=void 0===r?null:r;return this.list()||(this.create(e,t,Pe),n.write({current:e}),console.warn("create default example article [%s]",e)),a&&this.read(a),this.current}}]),e}();var ze=function(e){function t(e){var n;return Object(ie.a)(this,t),(n=Object(oe.a)(this,Object(se.a)(t).call(this))).rename=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=n.state,r=t.guid,a=t.name,i=t.original,o=i;!e&&a&&a.trim()&&a!==i&&(o=a.trim(),n.props.store.rename(r,o)),n.setState({edit:!1,name:o,original:o})},n.toggleEditAndFocus=function(e){e.stopPropagation(),n.setState({edit:!0});var t=n.state.guid;setTimeout(function(){return document.querySelector("#".concat(t)).focus()},150)},n.state={edit:!1,name:e.name,original:e.name,guid:e.guid},n}return Object(le.a)(t,e),Object(ue.a)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.name,r=t.edit,a=t.guid;return r?ne.a.createElement("input",{id:a,type:"text",tabIndex:"0",value:n,onBlur:function(){return e.rename()},onChange:function(t){e.setState({name:t.target.value})},onClick:function(e){return e.stopPropagation()},onKeyDown:function(t){var n=t.key,r=!1;/^(escape)/i.test(n)&&(n="enter",r=!0),/^(enter)/i.test(n)&&(e.rename(r),t.target.blur())}}):ne.a.createElement("span",{className:"file-toggle-input"},n,ne.a.createElement("a",{href:"#edit",onClick:this.toggleEditAndFocus},"edit"))}}]),t}(ne.a.Component);var Je,We,Me,qe,Ue=function(e){var t=e.object,n=e.callbacks,r=t.guid,a=t.uuid,i=t.name,o=t.wordtarget,s=t.opened,c=n.store,l=n.getArticleByGuid,u=n.updateCurrent,d=n.handleDelete,f=n.handleWordTarget,h=n.downloadText,m=n.downloadJson,v=o?"".concat(o," words"):"add",g=r||a;return ne.a.createElement("div",{className:"inner",onClick:function(){l(g),u(g)}},ne.a.createElement("span",{className:"file-name","data-guid":g},ne.a.createElement(ze,{name:i,guid:g,store:c})),ne.a.createElement("ul",{className:"file-meta"},ne.a.createElement("li",null,ne.a.createElement("a",{href:"#delete",onClick:function(e){e.preventDefault(),e.stopPropagation(),d(g)}},"del")),ne.a.createElement("li",{className:"file-words",onClick:function(e){return f(e,o,g)}},"Target: ",v),ne.a.createElement("li",{className:"file-modified"},X(s)),ne.a.createElement("li",{className:"file-exports"},ne.a.createElement("a",{href:"#txt",onClick:h},"txt"),ne.a.createElement("a",{href:"#json",onClick:m},"json"))))},$e=function(e){function t(e){var n;return Object(ie.a)(this,t),(n=Object(oe.a)(this,Object(se.a)(t).call(this))).readSelected=function(e){e.stopPropagation();var t=n.article,r=t.selected,a=void 0===r?null:r,i=t.texteditor,o=void 0===i?null:i,s=a&&a.innerText.trim()?a:o;s&&s.innerText&&window.TTS.read(s.innerText)},n.article=e.article,n.fs=ee.storage("settings"),n.state={guid:null,current:null,modifiers:{collapsed:!0,strikethrough:!0,typewriter:!1,markdown:!1,dark:!1},values:{fontsize:24,splitwidth:50}},n}return Object(le.a)(t,e),Object(ue.a)(t,[{key:"componentDidMount",value:function(){var e=this.fs.read(),t=Object(i.a)({},this.state);for(var n in e&&(t=Object(i.a)({},t,e),this.setState(t)),t.modifiers)console.log(n,t.modifiers[n]),this.toggleClassName(n,t.modifiers[n]);for(var r in t.values)this[r]&&(console.log(r,t.values[r]),this[r](t.values[r]))}},{key:"componentDidUpdate",value:function(e){var t={};this.props.current!==e.current&&(t.current=this.props.current),this.props.guid!==e.guid&&(t.guid=this.props.guid),this.props.splitwidth!==e.splitwidth&&(t.values={fontsize:this.state.values.fontsize,splitwidth:this.props.splitwidth}),Object.keys(t).length&&(console.log("settings got new props",t),this.setState(Object(i.a)({},t)),this.save())}},{key:"toggleClassName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"body",r=this.state,a=r.modifiers,i=r.values,o=document.querySelector(n),s=null;s="boolean"===typeof t?t:!a[e];var c=(s=Boolean(s))?"add":"remove";return o.classList[c](e),(e in a||e in i)&&(a[e]=s),null===t&&(this.setState({modifiers:a}),this.save()),!0===s}},{key:"getOnOff",value:function(e){return this.state.modifiers[e]?ne.a.createElement("i",{className:"icon-boolean-true"}):ne.a.createElement("i",{className:"icon-boolean-false"})}},{key:"fontsize",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];document.querySelector("body").style.fontSize="".concat(e,"px"),n&&(this.setState({values:{fontsize:Number(e)}}),ee.defer("fontsize",function(){return t.save()},500))}},{key:"save",value:function(){var e=this,t=this.fs;ee.defer("settings",function(){t.write(e.state),t.updateSettings(e.state)},500)}},{key:"render",value:function(){var e=this;return ne.a.createElement("ul",{className:"settings"},ne.a.createElement("li",null,ne.a.createElement("div",{className:"inner",onClick:function(){e.toggleClassName("dark")}},ne.a.createElement("strong",null,"Toggle dark theme"),ne.a.createElement("em",null,this.getOnOff("dark")))),ne.a.createElement("li",null,ne.a.createElement("div",{className:"inner",onClick:function(){e.toggleClassName("collapsed")}},ne.a.createElement("strong",null,"Collapse lines"),ne.a.createElement("em",null,this.getOnOff("collapsed")))),ne.a.createElement("li",null,ne.a.createElement("div",{className:"inner",onClick:function(){e.toggleClassName("strikethrough")}},ne.a.createElement("strong",null,"Strike through"),ne.a.createElement("em",null,this.getOnOff("strikethrough")))),ne.a.createElement("li",{className:"no-underline"},ne.a.createElement("div",{className:"inner"},ne.a.createElement("strong",null,"Font size"),ne.a.createElement("em",null,[this.state.values.fontsize,"px","/",ee.points(this.state.values.fontsize),"pt"].join(""))),ne.a.createElement("input",{type:"range",id:"fontsize",name:"fontsize",min:"12",max:"48",defaultValue:this.state.values.fontsize,onChange:function(t){var n=t.target.value;e.fontsize(n,!0)}})),ne.a.createElement("li",null,ne.a.createElement("div",{className:"inner",onClick:function(){var t=e.article,n=e.toggleClassName("typewriter"),r=t.typewriter(n);r=void 0===n?!r:r,t.typewriter(r)}},ne.a.createElement("strong",null,"Typewriter mode"),ne.a.createElement("em",null,this.getOnOff("typewriter")))),ne.a.createElement("li",null,ne.a.createElement("div",{className:"inner",onClick:this.readSelected},ne.a.createElement("strong",null,"Read aloud (BETA)"),ne.a.createElement("em",null,"stop|start"))))}}]),t}(ne.a.Component),He=!1,Be={width:50,minWidth:10,threshold:15};function Ve(e,t){if(!e)return Be;var n={};e.constructor!==Object&&void 0!==t&&(n[e]=t,e=Object(i.a)({},n)),Be=Object(i.a)({},Be,{key:e})}function Ge(e,t){if(He||t){var n=(e||{}).pageX;e&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1);var r=Be,a=r.threshold,i=r.minWidth,o=window.innerWidth;n=n||(t||50)/100*o;var s=t||Number(n/o*100);s=Math.max(i,s);var c=s=Math.min(100-i,s);Je.classList.remove("hide-content"),We.classList.remove("hide-content"),Me.classList.remove("hide-menu-left"),Me.classList.remove("hide-menu-right"),s<a&&(c=i/o*100,Je.classList.add("hide-content"),Me.classList.add("hide-menu-left")),s>100-a&&(c=100-1.5*i/o*100,We.classList.add("hide-content"),Me.classList.add("hide-menu-right")),Je.style.width="".concat(c,"%"),We.style.width="".concat(100-c,"%"),Me.style.left="".concat(c,"%"),qe&&qe(Number(c))}}var Ke={};function Fe(e,t){Ke[e].innerHTML=t}function Ye(e){qe=e}function Xe(e){var t=document.createElement("div");t.id=e,t.className="divider-".concat(e),Me.appendChild(t),Ke[e]=t}var _e=function(e,t){return Me=document.querySelector("#vertical"),Je=document.querySelector(".paragraphs"),We=document.querySelector(".sentences"),Me.onmousedown=function(){return He=!0},Me.ondblclick=function(e){return Ge(e,50)},t(null,"up",function(){return He=!1}),t(null,"move",Ge),Be.width=e||50,Ge(null,Be.width),console.log("resizer initialized"),{resize:Ge,settings:Ve,add:Xe,update:Fe,onResize:Ye}},Qe=ee.storage("settings").read,Ze=document.querySelector("html");window.addEventListener("keydown",function(e){var t;e.altKey&&("show-alternative",t=Ze.classList.contains("show-alternative")?"remove":"add",Ze.classList[t]("show-alternative"))});var et=function(e){function t(e){var n;return Object(ie.a)(this,t),(n=Object(oe.a)(this,Object(se.a)(t).call(this))).saveToDisk=function(){ee.defer("savearticle",function(){var e=n.props.article,t=n.state,r=t.current,a=t.guid,i=t.articles,o=ee.storage(r),s=e.texteditor.children,c=new ye(s).toCollection(),l=i.find(function(e){return e.uuid===r});l||(console.log("No meta data. New article?"),l=o.read().meta);var u={data:c,meta:l};o.write(u),o.updateArticle(a,r,u)},1500)},n.saveDividerWidth=function(e){ee.defer("splitwidth",function(){console.log("save divider width",e),n.setState({splitwidth:e})},750)},n.syncWithServer=function(e){if(e){var t=ee.storage("articles"),a={},i=t.read();i.forEach(function(e){console.log("local timestamps",e.uuid),a[e.uuid]=e.modified||e.opened}),t.getUser(e).then(function(o){var s,c,l,u=function(n){return/settings$/.test(n)?"continue":((s=o[n].meta).uuid=n,a[n]?(c=ee.storage(n).read(),l=o[n],c.meta.modified-l.meta.modified>1e4?(console.log("Replace remote data",n,e),t.updateArticle(e,n,c),"continue"):(ee.storage(n).write(l),i=i.filter(function(e){return e.uuid!==n}),console.log(222222,i),void i.push(l.meta))):(console.log("Create local article [%s]",n),ee.storage(n).write(o[n]),(i=i.filter(function(e){return e.uuid!==n})).push(s),"continue"))};for(var d in o)u(d);t.write(i),ee.storage("settings").write(o.settings),n.setState({articles:Object(r.a)(i),guid:e})})}else console.warn("Require sync profile id")},n.updateCurrent=function(e){var t=n.state;t.current=e,n.setState(t);var r=document.querySelector("body");r.classList.add("sidebar-close"),ee.defer("animate",function(){r.classList.remove("sidebar-close"),r.classList.remove("show-sidebar")},350)},n.getArticleByGuid=function(e){var t=n.props,r=t.store,a=t.article,i=r.read(e),o=i.data;return a.setWordTarget(i.wordtarget),a.reset(o)},n.handleWordTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;e.preventDefault(),e.stopPropagation();var a=e.target,i=ee.storage(r),o=i.read(),s=ee.prompt("Enter a word count target for this document.",t);o.meta.wordtarget=Number(s)||0,i.write(o),i.update(o),a.innerHTML="Target ".concat(s||": add"),console.log("set word targetr",n.state.current,r),n.state.current===r&&(n.props.article.setWordTarget(s),n.props.article.wordcounter())},n.handleDelete=function(e){var t=n.props.store;if(!window.confirm("You are about to delete this file.\nAre you sure?"))return!1;t.delete(e),ee.storage().deleteArticle(e);var r=t.list();e===n.state.current&&r.length&&(e=r[0].uuid,console.log("Delete current. re-initalize editors",e),n.getArticleByGuid(e)),e=r.length?e:null,n.setState({articles:r,current:e})},n.makeEditable=function(e,t,r){e.stopPropagation();var a=n.props.store.rename;return console.log(123,t,r),ne.a.createElement("input",{type:"text",defaultValue:t,onBlur:function(e){return a(r,e.target.value)},onKeyPress:function(e){return e.stopPropagation(),/enter/i.test(e.key)&&(e.target.blur(),a(r,e.target.value)),!0}})},n.handleImport=function(e){var t=n.props.store,r=Object(ce.a)(n),a=r.getArticleByGuid,i=r.updateCurrent,o=Object(ce.a)(n);t.open(e,function(e,n){var r=new ye(n),s=t.create(null,e,r.toCollection()),c=s.meta.uuid,l=o.state.guid;console.log("Import user:[%s] uuid[%s]",l,c,s),a(c),i(c),ee.storage().updateArticle(l,c,s)})},n.handleDataRestore=function(e){var t=ee.backupRestore.restore,n=ee.readTextFile;return n(e,function(e,n){var r=JSON.parse(n),a=Object.keys(r).filter(function(e){return/(articles|previous|settings)$/i.test(e)});if(console.log(a),3!==!a.length){if(ee.confirm("You are about to overwrite existing data.\nAre you sure?"))return Object.keys(localStorage).forEach(function(e){return e.indexOf()+1?delete localStorage[e]:null}),t("rewrite",r)}else console.error("Restore failed integrity check",r)})},n.download=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"text",t={text:"toText",markdown:"toMarkdown",json:"toCollection"}[e]||"text",r=Object(ce.a)(n).state;return function(n){n.preventDefault(),n.stopPropagation();var a=!!n.altKey,i=r.current,o=ee.storage(i).read(i),s=o.data,c=o.meta,l=c.name,u=c.uuid,d=(new Date).toISOString().replace(/:\d+.\d+.$/,"").replace("T"," "),f=a?ee.prompt("Enter filename","".concat(l,"-").concat(d)):l;if(l&&l.trim()){var h={name:f,id:u,data:new ye(s)[t](),type:e,appendId:!1};return ee.download(h)}console.log("No file name",i,u,l,s)}},n.state={guid:null,current:null,splitwidth:50,articles:[]},e.article.on("after",null,n.saveToDisk.bind(Object(ce.a)(n))),e.sentences.on("after",null,n.saveToDisk.bind(Object(ce.a)(n))),n}return Object(le.a)(t,e),Object(ue.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.getUpdatedArticles(),n=Qe()||this.state,r=n.guid,a=void 0===r?null:r,i=n.current,o=void 0===i?null:i,s=n.values,c=((void 0===s?null:s)||{}).splitwidth,l=void 0===c?50:c,u={articles:t,guid:a,current:o,splitwidth:l};this.setState(u),this.mouse=this.props.mouse,this.divider=_e(l,this.mouse),this.divider.add("wordcount"),this.divider.onResize(this.saveDividerWidth),this.props.article.on("wordcounter",null,function(t){return e.updateWordCount(t)}),this.props.sentences.on("wordcounter",null,function(){return e.props.article.wordcounter()}),this.props.store.setSyncProfile(a),this.registerMouseEvent()}},{key:"getUpdatedArticles",value:function(){return this.props.store.list()}},{key:"registerMouseEvent",value:function(){var e=this,t=document.querySelector("body"),n=document.querySelector("#sidebar"),r=[5,n.offsetWidth+50];t.classList.contains("show-sidebar");this.props.mouse(null,"move",function(a){var i=a.pageX;r[1]=n.offsetWidth+50,!t.classList.contains("show-sidebar")&&i>r[0]||(i>r[1]&&(t.classList.add("sidebar-close"),ee.defer("animate",function(){t.classList.remove("sidebar-close"),t.classList.remove("show-sidebar"),Ze.classList.remove("show-alternative")},250)),i<r[0]&&(e.setState({articles:e.getUpdatedArticles()}),t.classList.add("show-sidebar"),ee.defer("sidebar",function(){return i>r[1]?t.classList.remove("show-sidebar"):null},500)))})}},{key:"updateWordCount",value:function(e){this.divider.update("wordcount",e)}},{key:"getArticles",value:function(){var e=this.getUpdatedArticles(),t=this.state.current||e[0].uuid,n=this.props.store,r={getArticleByGuid:this.getArticleByGuid,updateCurrent:this.updateCurrent,handleDelete:this.handleDelete,handleWordTarget:this.handleWordTarget,store:n,downloadText:this.download("text"),downloadJson:this.download("json")},a=null;return e&&e.length&&(a=e.map(function(e,n){var a=e.guid||e.uuid,i=a===t?"selected":"";return ne.a.createElement("li",{key:a,className:i},ne.a.createElement(Ue,{object:e,callbacks:r}))})),ne.a.createElement("div",{id:"files"},ne.a.createElement("hr",null),ne.a.createElement("ul",null,a))}},{key:"render",value:function(){var e=this,t=this.getArticles();return ne.a.createElement("div",null,ne.a.createElement("ul",{className:"actions"},ne.a.createElement("li",null,ne.a.createElement("div",{className:"inner",onClick:function(){var t=e.props.store.create(null,"Untitled",[{text:"New document ..."}]);e.getArticleByGuid(t.meta.uuid),e.updateCurrent(t.meta.uuid)}},"New")),ne.a.createElement("li",null,ne.a.createElement("label",{htmlFor:"uploadInput",className:"inner"},ne.a.createElement("span",null,"Open"),ne.a.createElement("input",{id:"uploadInput",className:"hidden",onChange:this.handleImport,type:"file",accept:"text/*"}))),ne.a.createElement("li",null,ne.a.createElement("div",{className:"inner",onClick:this.download("text")},ne.a.createElement("span",null,"Save ",ne.a.createElement("i",{className:"on-alternative-inline"},"As")))),ne.a.createElement("div",{className:"on-alternative"},ne.a.createElement("li",null,ne.a.createElement("div",{className:"inner",onClick:function(){var e=ee.download,t=(0,ee.backupRestore.backup)("rewrite");return e({name:"rewriting-backup",id:(new Date).toISOString(),data:t})}},ne.a.createElement("span",null,"Backup"))),ne.a.createElement("li",null,ne.a.createElement("label",{htmlFor:"restoreData",className:"inner"},ne.a.createElement("span",null,"Restore"),ne.a.createElement("input",{id:"restoreData",className:"hidden",onChange:this.handleDataRestore,type:"file",accept:"text/json"}))),ne.a.createElement("li",null,ne.a.createElement("div",{className:"inner",onClick:function(){var t=ee.prompt("Enter your sync id:");e.syncWithServer(t),e.setState({guid:t})}},ne.a.createElement("span",null,"Sync Profile"),ne.a.createElement("em",null,this.state.guid||"Not syncing"))))),t,ne.a.createElement($e,{article:this.props.article,guid:this.state.guid,current:this.state.current,splitwidth:this.state.splitwidth}))}}]),t}(ne.a.Component),tt=(n(23),{up:[],move:[]});function nt(e,t,n){if(n)return tt[t].push(n);tt[t].forEach(function(t){return t(e)})}window.onmouseup=function(e){return nt(e,"up")},window.onmousemove=function(e){return nt(e,"move")};var rt=new Re(ee.storage.bind(window)),at=new Ee("c1",{prefix:"a",hidden:!0}),it=new xe("c2",{prefix:"s",hidden:!0}),ot=rt.initilize();at.bindTo(it),it.bindTo(at),window.RE={storage:rt,article:at},setTimeout(function(){document.querySelector(".container").classList.remove("hidden"),document.querySelector(".sidebar").classList.remove("hidden"),document.querySelector(".overlay").classList.add("hidden"),at.init(ot&&ot.data||[""])},1950);var st=document.querySelector("#sidebar");ae.a.render(ne.a.createElement(et,{store:rt,article:at,sentences:it,mouse:nt}),st);var ct=document.querySelector("#overlay");ae.a.render(ne.a.createElement("div",{className:"brand"},ne.a.createElement("img",{src:"./static/images/rewriting.svg",alt:"writing is rewriting"})),ct)}},[[14,1,2]]]);
//# sourceMappingURL=main.c3f1ff54.chunk.js.map